<!----><div><h1>Introduction to Web Secure Coding</h1>
<p>In this Learning Module, we will cover the following Learning Units:</p>
<ul>
<li>Trust Boundaries</li>
<li>Untrusted Input Handling</li>
<li>Output Encoding and Character Escaping</li>
<li>File Handling</li>
<li>Parameterized Queries</li>
</ul>
<p>When developing applications, security should not be an afterthought.
As an application grows, it becomes increasingly more difficult to
"add security later". Instead, we should try to write code in a such
a way that reduces the chances of introducing vulnerabilities in the
first place, a practice known as <em>secure coding</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p>
<p>There are a variety of practices that can improve the overall
security posture of an application. However, since modern frameworks
often include a baseline set of security controls, in this module
we will focus on controls that can prevent or mitigate most common
vulnerabilities in web applications.</p>
<p>We will start by discussing trust boundaries and how they factor into
application security. Then, we'll focus on input validation and output
encoding. Finally, we will discuss parameterized queries. While there
are many other topics related to secure coding, these will form a
basic foundation for the process of securely coding web applications.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Secure_coding" target="_blank">https://en.wikipedia.org/wiki/Secure_coding</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!---->

<!----><div><h2>Trust Boundaries</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand trust boundaries</li>
<li>Understand how to identify trust boundaries in applications</li>
<li>Understand subresource integrity</li>
<li>Calculate a hash using openssl</li>
<li>Understand the concept of defense-in-depth</li>
</ol>
</div><!---->

<h2>Intro to Trust Boundaries</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>A <em>trust boundary</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> in an application is point
at which data or commands change permission levels. For example,
data submitted by a user without validation is at a different
trust level than data the application has validated server-side.
Likewise, unauthenticated users operate at a different trust level
than authenticated administrative users. Applications must apply
security controls consistently at all trust boundaries to protect the
application from untrusted input.</p>
<p>Developers must understand trust boundaries between disparate systems
to avoid "second order" attacks wherein a payload is submitted to
one system and exploited in another. This concept is becoming more
important as developers trend toward smaller applications with
collections of <em>microservices</em>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></p>
<p>Let's review an example and practice identifying trust boundaries in a
web application.</p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_coding/3e617160124e74e9fdf7a3ce50a1e26c-scw_trust_boundaries_01.png" alt="Figure 1: A basic data flow diagram">
<figcaption>Figure 1: A basic data flow diagram</figcaption>
</figure>
<p></p>
<p>Figure 1 describes the data flow in a
basic web application. Users interact with an application server over
the Internet. The application server connects to a database server.
In older, monolithic applications, the database might even run on the
same server as the web application. For the sake of simplicity, we
have omitted appliances like routers and firewalls from the diagram.</p>
<p>The first trust boundary exists between the application server and
the Internet. While our application provides content (such as HTML,
JavaScript, images, etc.) to the user and their browser, we have
limited ways to guarantee outside parties have not manipulated our
content in transit or in the browser. For example, some ISPs inject
advertisements into HTML responses and some users attempt to block
them with various browser plugins such as ad blockers. Each of these
manipulate data in transit to the browser.</p>
<p>A second trust boundary occurs between the application server and
the database server. While an application might be responsible for
writing most of the data contained within the database, there may
be situations in which unintended data ends up in the database.
For example, database administrators (DBAs) might interact with the
database directly. Attackers might be able to bypass input validation
and inject malicious data into the database.</p>
<p>Next, let's consider a web application using a basic interpretation of
microservices architecture.</p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_coding/65fbcbe4226402682b3ce06018353467-scw_trust_boundaries_02.png" alt="Figure 2: A basic microservices data flow diagram">
<figcaption>Figure 2: A basic microservices data flow diagram</figcaption>
</figure>
<p></p>
<p>The web application in Figure 2
uses an API to handle some logic and a <em>content delivery network</em>
(CDN)<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> to host and deliver JavaScript files. The trust
boundaries we identified last time still apply here. The addition of
an API creates a new trust boundary between the web application and
the API. Another trust boundary exists between the API server and
its database, but from the perspective of the developer responsible
for the web application, that boundary is non-essential. If we don't
automatically trust any data from the API, any downstream integrations
of the API do not concern us.</p>
<p>Using a CDN to handle resources, such as JavaScript, introduces an
interesting delegation of trust. If our application serves HTML that
includes resources from an external domain, we don't have direct
control over those contents. If attackers compromise the CDN, it could
start serving malicious content that applications may load. We'll
learn how to prevent this type of attack in the next section.</p>
<p>For the following exercise, consult the data flow diagram below.</p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_coding/21347abd4256ed9ab0859d01d2076e4a-scw_trust_boundaries_03.png" alt="Figure 2: A data flow diagram">
<figcaption>Figure 2: A data flow diagram</figcaption>
</figure>
<p></p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Trust_boundary" target="_blank">https://en.wikipedia.org/wiki/Trust_boundary</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Microservices" target="_blank">https://en.wikipedia.org/wiki/Microservices</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Content_delivery_network" target="_blank">https://en.wikipedia.org/wiki/Content_delivery_network</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Subresource Integrity</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p><em>Subresource Integrity</em> (SRI)<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> instructs the browser to
not load a resource if the hash of the resource does not match a
pre-provided value. We can set an <em>integrity</em> attribute with the
pre-defined hash value as part of a <em>script</em> or <em>link</em> element.</p>
<p>Let's review an example of a <em>script</em> element with SRI enabled.</p>
<pre id="fence-code-3" class="fence-code"><code>&lt;script src="scripts/bootstrap.min.js" <span class="code-block-p">integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"</span> <span class="code-block-s">crossorigin="anonymous"</span>&gt;&lt;/script&gt;
</code></pre>
<blockquote>
<p>Listing 1 - Example script element with SRI enabled</p>
</blockquote>
<p>The <em>script</em> element in Listing 1 includes an
<em>integrity</em> attribute. Notice how the <em>integrity</em> value begins with
"sha384". This indicates the base64-encoded hash value after the dash
was calculated with the SHA384 algorithm. The currently supported
algorithms are SHA256, SHA384, and SHA512. We must include the
<em>crossorigin</em> attribute when using SRI on resources hosted on external
domains. This also means the site hosting the resources must support
<em>Cross-Origin Resource Sharing</em> (CORS)<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> to enable SRI. The
"anonymous" value used in this example means the browser will only
send credentials, such as HTTP cookies, if the request is to the same
origin.</p>
<p>In Kali Linux, we can use <em>openssl</em> to calculate and base64-encode
a hash value of a file. We need to set <span class="pr-block">dgst</span> to create a
message digest, specify the algorithm with <span class="pr-block">-sha384</span>, set
<span class="pr-block">-binary</span> to generate binary output, and finally the file
we want hashed. Since we need the result base64-encoded, we'll pipe
the binary output to openssl (with the <span class="pr-block">base64</span> argument)
to base64-encode the output and use <span class="pr-block">-A</span> to write the base64
output as a single line.</p>
<pre id="fence-code-4" class="fence-code has-commands"><code>kali@kali:~$ <span class="code-block-ui">openssl dgst -sha384 -binary test.js | openssl base64 -A</span>
<span class="code-block-p">IMR5mPD7vl9kNTutndXHoFmH1NmdJzbzv1hmrKNN8UR+98beWaNSRJ9d9Ymkcs+c</span>   
</code></pre>
<blockquote>
<p>Listing 2 - Calculating the hash of a file with openssl</p>
</blockquote>
<p>Even a minor change to the file will change the file's hash value. For
this reason, it is common to link to a specific version of a resource
when using SRI to prevent browsers from rejecting a resource due to
updates.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity" target="_blank">https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Defense in Depth</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Software should have multiple layers of security embedded
throughout the application. This is known as <em>defense in
depth</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> Our goal is to leverage centralized
controls, while avoiding a single point of failure.</p>
<p>For example, it's a good idea to use a set of functions to handle
input sanitization consistently across the application. However,
if we only apply input sanitization to unauthenticated users while
exempting authenticated users, we put the application at risk.
An application should consistently perform output encoding when
displaying user-supplied data, even if it has already validated the
data. Consistently applying multiple controls increases the security
posture of an application and may prevent a single bug in one security
control from allowing attackers to compromise the application.</p>
<p>Additionally, we cannot not rely on client-side controls as a sole
security mechanism. We previously mentioned how attackers can bypass
these controls.</p>
<p>JavaScript In-browser validation can reduce erroneous traffic from the
user to the server from normal users but client-side validation is not
a secure control. Malicious users have control over their browser and
can modify the DOM in their browser or send requests with non-browser
tools such as curl or Burp Suite.</p>
<p>One of the best ways to prevent common web application vulnerabilities
is to apply a set of consistent security controls throughout an
application's data flows. This may include validating user-supplied
input, using parameterized queries when accessing a database, and
performing output encoding when returning data to users. Using this
approach, an attack payload must make it through multiple layers of
controls to be effective. We'll discuss these types of controls in
subsequent Learning Units.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Defense_in_depth_(computing)" target="_blank">https://en.wikipedia.org/wiki/Defense_in_depth_(computing)</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Untrusted Input Handling</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand the concept of input validation</li>
<li>Understand the importance of enforcing data types</li>
<li>Understand common dangerous characters</li>
<li>Understand the basics of blocklists and allowlists</li>
<li>Understand the basics of pattern validation</li>
</ol>
</div><!---->

<h2>Intro to Input Validation</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Mishandling data can cause common web application vulnerabilities.
In addition, handling unexpected data can create logic errors in an
application. This can be prevented with <em>input validation</em> in which
input is stripped of dangerous characters and validated by data type,
length, format, and character set. This process should happen as early
as possible when receiving input.</p>
<p>Regardless of which approaches developers choose to use, and in what
combination, input validation must be applied consistently. Malicious
actors can disable or bypass client-side controls implemented in
the browser, such as those implemented in JavaScript. Therefore,
server-side code is preferred for input validation and sanitization.</p>
</div><!----></div>

<h2>Enforcing Data Types</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Mishandling data types in dynamically-typed programming
languages<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> can lead to logic errors. If these errors
occur in security controls, attackers might be able to bypass the
vulnerable controls to access sensitive data or functionality.</p>
<p>Dynamically-typed languages will often try to check data types
at runtime, performing type conversions automatically as needed.</p>
<p>Specifically, dynamically-typed languages often have different
operators for checking the equivalency of two values. The first
includes an <em>abstract equality</em> check with the <em>==</em> operator which
will automatically convert data types and a <em>strict equality</em> check
with the <em>===</em> operator which checks equality without performing a
type conversion.</p>
<p>Let's consider an example in JavaScript, a dynamically typed language:</p>
<pre id="fence-code-5" class="fence-code"><code>&gt; "1" == 1;
true
&gt; "1" == true;
true
&gt; "1" === 1;
false
</code></pre>
<blockquote>
<p>Listing 3 - Comparing different data types in JavaScript</p>
</blockquote>
<p>In the listing above, the string value of "1" is equal to the integer
1 and the Boolean true when using an abstract equality comparison.
However, when using a strict equality comparison, the string value "1"
does not equal the integer value 1 since no type conversion occurs.</p>
<p>If we attempted to perform these same comparisons in a strongly typed
language,<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> such as Java, we would receive errors as
illustrated in the listing below.</p>
<pre id="fence-code-6" class="fence-code"><code>jshell&gt; "1"==1;
|  Error:
|  bad operand types for binary operator '=='
|    first type:  java.lang.String
|    second type: int
|  "1"==1;
|  ^----^

jshell&gt; 1== true;
|  Error:
|  incomparable types: int and boolean
|  1== true;
|  ^------^
</code></pre>
<blockquote>
<p>Listing 4 - Comparing different data types in Java</p>
</blockquote>
<p>Strongly-typed languages usually need the values converted into the
same data type before the values can be compared. Some programming
languages fall between strongly typed and weakly typed. For instance,
Python allows a variable to hold different types by simply reassigning
values. However, we can check the current type of a variable with the
<em>type()</em> function.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></p>
<p>If an application uses abstract equality with loosely-typed variables
in security-sensitive operations, attackers might be able to bypass
controls by submitting values that fulfill abstract equality checks.
Applications should therefore cast input to the expected data type and
use strict equality comparisons.</p>
<p>For the next exercise, consider the following JavaScript code:</p>
<pre id="fence-code-7" class="fence-code"><code>"1" === true;
</code></pre>
<blockquote>
<p>Listing 5 - Comparing different values in JavaScript</p>
</blockquote>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Type_system#Dynamic_type_checking_and_runtime_type_information" target="_blank">https://en.wikipedia.org/wiki/Type_system#Dynamic_type_checking_and_runtime_type_information</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Type_system#Static_type_checking" target="_blank">https://en.wikipedia.org/wiki/Type_system#Static_type_checking</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Python Software Foundation, 2021), <a href="https://docs.python.org/3/library/functions.html#type" target="_blank">https://docs.python.org/3/library/functions.html#type</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Dangerous Characters</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Some text characters have special meaning when passed outside of
applications to operating system commands, SQL queries, or HTML.
Generally, the list of "dangerous" characters includes the following:</p>
<pre id="fence-code-8" class="fence-code"><code>&lt; &gt; ' " ; * : { }
</code></pre>
<blockquote>
<p>Listing 6 - Dangerous characters</p>
</blockquote>
<p>However, an exact list of dangerous characters or keywords varies by
context. In other words, an attack against a database and an attack
against a browser will have different dangerous characters. For
example, an ampersand (&amp;) character denotes parameters in a query
string or POST body, but it can be used to chain together OS commands.
If an application renders user-supplied data in HTML responses, the
list of dangerous characters varies depending on where the malicious
data is included in the application.</p>
<p>Let's review a few examples using HTML.</p>
<pre id="fence-code-9" class="fence-code"><code>&lt;html&gt;
&lt;body&gt;
    &lt;div&gt;Hello [INPUT HERE]&lt;/div&gt;
    ...
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p>Listing 7 - Sample HTML</p>
</blockquote>
<p>In this example, the application writes user-supplied data into a
<em>div</em> element. If the application lacks input validation and output
encoding, attackers could potentially inject "&lt;" and "&gt;" characters,
including arbitrary JavaScript or HTML, resulting in a <em>cross-site
scripting</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> attack.</p>
<p>Here's another example:</p>
<pre id="fence-code-10" class="fence-code"><code>&lt;html&gt;
&lt;head&gt;
    &lt;script&gt;
        var x = "[INPUT HERE]";
        ...
    &lt;/script&gt;
&lt;body&gt;
    ...
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p>Listing 8 - Sample HTML and JavaScript</p>
</blockquote>
<p>In this example, the application writes user-supplied into a block
of JavaScript. Instead of needing "&lt;" and "&gt;", attackers could
simply inject double quotes and a semicolon (";) followed by their
own JavaScript code. Placing user supplied-data into script blocks and
event handlers is very dangerous and should be avoided if possible.</p>
<p>These examples are not exhaustive but are meant to illustrate
the importance of context when handling user-supplied data in web
applications.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank">https://en.wikipedia.org/wiki/Cross-site_scripting</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Blocklists and Allowlists</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Blocklists and Allowlists are two common approaches to performing
input validation.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p>
<p>Blocklist validation uses a list of known bad values. If a value
is on the list, it is considered invalid and must be rejected. This
technique is often used by developers in an attempt to block certain
malicious payloads. For example, the single quote or apostrophe
character (') has special meaning in SQL queries and is often used
in a SQL injection attack. Developers might build a block list that
includes this character. Such a list, if implemented without care,
could have unintended consequences such as blocking legitimate names
which contain with apostrophes.</p>
<p>A blocklist by itself is essentially the opposite of a <em>Default Deny</em>
policy. This concept comes from network security, but it applies to
software as well, especially code that deals with user permissions.
In essence, a Default Deny policy means unless an action is explicitly
allowed, it is denied. We could paraphrase a blocklist as "allow
all characters or words that are not on this list". In addition,
a blocklist is not considered to be a sufficient input validation
approach but works best when combined with other techniques which are
explained below.</p>
<p>Allowlist validation uses a list of known good values. If a value is
not on the list, it is invalid and the application should reject it.
This approach works best when a value should be part of a finite,
well-defined data set.</p>
<p>For example, if we built a car sales website that allows users to sort
by color, we could build an allowlist containing the most common car
colors. Our application could use this list to validate that "red" is
valid input, while "pleurigloss" is not.</p>
<p>Allowlists and blocklists can contain entire words or
individual characters. For example, a blocklist could validate that
a field does not contain any numbers. However, pattern validation
can often be a better tool for granular validation rules. We'll learn
about pattern validation in the next section.</p>
<p>For the following exercise, consult the listing below.</p>
<pre id="fence-code-11" class="fence-code"><code>function isValid(input) {
    list = ['script','src','alert']
    valid = true
    for word in list {
        if input.contains(word) {
            valid = false
        }
    }
    return valid
}
</code></pre>
<blockquote>
<p>Listing 9 - Pseudocode input validation function</p>
</blockquote>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(CheatSheets Series Team, 2021),  <a href="https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html#allow-list-vs-block-list" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/Input_Validation_Cheat_Sheet.html#allow-list-vs-block-list</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Pattern Validation</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Sometimes data follows a known pattern, but contains unknown values.
For example, email addresses must contain a name, the @ symbol, and
a domain name. It would be nearly impossible to build a list of valid
email addresses, but we could use a <em>regular expression</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>
(also referred to as regex) to validate that a given string of text
matches the pattern of an email address. We could also use regular
expressions to scan for the existence of special characters.</p>
<p>Let's create a pattern that matches email addresses which usually
contain a name or identifier, an "at sign" (@), and a domain name.
We can use regular expressions to check for specific characters,
sequences of characters, or <em>character classes</em>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> By
comparing character classes, we can match on the types of characters,
such as numeric or non-numeric. For example, "\d" matches any numeric
value without having to specify 0-9.</p>
<p>To match the name component of an email address, we'll use
<span class="pr-block">[\w.]+</span> which matches match any alphanumeric character. The
"." characters match a period because it is inside square brackets,
which mark a <em>character group or class</em>.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> Outside of
a character class, a period matches any character unless escaped with
a backslash. The plus sign (+) after the square brackets means "one or
more". This pattern should match any alphanumeric characters including
periods.</p>
<p>We can match an at sign with <span class="pr-block">@</span>. For the final part of the
regex pattern, we'll use <span class="pr-block">\w+.\w+</span> to match any number of
alphanumeric characters, followed by a period and more alphanumeric
patterns.</p>
<p>This is the final pattern, including forward slash delimiters:</p>
<pre id="fence-code-12" class="fence-code"><code>/[\w.]+@\w+.\w+/
</code></pre>
<blockquote>
<p>Listing 10 - A regex pattern to validate email addresses</p>
</blockquote>
<p>There are many ways to write regular expressions that match a single
pattern. Any time we use regular expressions for data validation, we
will need to test them to ensure there aren't any false positives or
false negatives.</p>
<p>Let's try using this pattern in our browser's Web Console. In Firefox,
we can open the Console with <span class="kb-block">C B k</span>. We'll start by declaring
a variable named "ourPattern" and assign it the regex pattern from
Listing 10. In JavaScript, we use forward slashes (/)
as pattern delimiters.</p>
<pre id="fence-code-13" class="fence-code has-commands"><code>&gt;&gt; <span class="code-block-ui">ourPattern = /[\w.]+@\w+.\w+/</span>
/[\w\.]+@\w+.\w+/
&gt;&gt;
</code></pre>
<blockquote>
<p>Listing 11 - Declaring a regex in JavaScript</p>
</blockquote>
<p>We can use the <em>test()</em><sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> method to check if the regex
matches a string. The method will return "true" if the pattern and
string match. If they don't match, the method will instead return
"false".</p>
<pre id="fence-code-14" class="fence-code has-commands"><code>&gt;&gt; <span class="code-block-ui">ourPattern.test("tom.jones@test.com")</span>
<span class="code-block-p">true</span>
</code></pre>
<blockquote>
<p>Listing 12 - Comparing a string to a regex</p>
</blockquote>
<p>Since the string matched the pattern, the method returned "true". This
example matched against the entire string. Most programming languages
support other methods,<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup> including those that can split
strings based on regex or replace-any matches.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Regular_expression" target="_blank">https://en.wikipedia.org/wiki/Regular_expression</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Character_Classes" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Character_Classes</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Groups_and_Ranges" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions/Groups_and_Ranges</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn5"><sup>5</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#using_regular_expressions_in_javascript" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#using_regular_expressions_in_javascript</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Output Encoding and Character Escaping</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand the concept of output encoding</li>
<li>Understand how to perform output encoding</li>
<li>Understand that context matters when determining which characters
need to be encoded</li>
<li>Understand the concept of character escaping</li>
</ol>
</div><!---->

<h2>Intro to Output Encoding</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>An application may need to accept and display dangerous characters.
Applications can use <em>output encoding</em> (also known as output escaping)
to display these characters as text, rendering them non-exploitable.
One common way to perform output encoding for HTML is through the
use of <em>HTML entities</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> For example, if we want to
display a less than symbol ("&lt;") in HTML as text and not part of a
tag, we could use the HTML entity representation "&amp;lt;".</p>
<p>Many programming languages include functions to convert
special characters to HTML entities. However, these functions
alone might not be sufficient to protect against cross-site
scripting without additional configuration. For example,
Python's <em>html.escape()</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> function and PHP's
<em>htmlentities()</em><sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> function will both encode "&lt;"
and "&gt;" by default, but they require an additional flag to encode
single quotes.</p>
<p>Let's try an example using Python in our Kali Linux VM. We'll start
by running <span class="pr-block">python3</span>. Next, we'll import the html module with
<span class="pr-block">import html</span>. Finally, we'll call the <em>html.escape()</em> function
on a string.</p>
<pre id="fence-code-15" class="fence-code has-commands"><code>kali@kali:~$ <span class="code-block-ui">python3</span>
Python 3.9.2 (default, Feb 28 2021, 17:03:44) 
[GCC 10.2.1 20210110] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; <span class="code-block-ui">import html</span>
&gt;&gt;&gt; <span class="code-block-ui">html.escape("&lt;div&gt;Great tacos today, Jake!&lt;/div&gt;")</span>
<span class="code-block-p">'&amp;lt;div&amp;gt;Great tacos today, Jake!&amp;lt;/div&amp;gt;'</span>
&gt;&gt;&gt; 
</code></pre>
<blockquote>
<p>Listing 13 - Using html.escape() to perform HTML encoding</p>
</blockquote>
<p>The function converted "&lt;" to "&amp;lt;" and "&gt;" to "&amp;gt;". We can
also pass <em>quote=True</em> into the function to encode single and double
quotes. We can decode the results using <em>html.unescape()</em>.</p>
<pre id="fence-code-16" class="fence-code has-commands"><code>&gt;&gt;&gt; <span class="code-block-ui">html.unescape('&amp;lt;div&amp;gt;Great tacos today, Jake!&amp;lt;/div&amp;gt;')</span>
<span class="code-block-p">'&lt;div&gt;Great tacos today, Jake!&lt;/div&gt;'</span>
&gt;&gt;&gt; <span class="code-block-ui">exit()</span>
</code></pre>
<blockquote>
<p>Listing 14 - Using html.unescape() to perform HTML decoding</p>
</blockquote>
<p>We have the original string back after calling <em>html.unescape()</em> and
can exit the Python interpreter with <span class="pr-block">exit()</span>.</p>
<p>Many <em>template engines</em><sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> will automatically
perform output encoding by default. However, some engines might
consider output encoding an optional function that must be explicitly
called or otherwise globally enabled via configuration.</p>
<p>It is also important to remember that context (or where the data
will be used) determines how we should encode data. The dangerous
characters for writing data into an HTML element are different than
which characters are dangerous when writing into JavaScript.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Glossary/Entity" target="_blank">https://developer.mozilla.org/en-US/docs/Glossary/Entity</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Python Software Foundation, 2021), <a href="https://docs.python.org/3/library/html.html" target="_blank">https://docs.python.org/3/library/html.html</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(The PHP Group, 2021), <a href="https://www.php.net/manual/en/function.htmlentities.php" target="_blank">https://www.php.net/manual/en/function.htmlentities.php</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Template_processor" target="_blank">https://en.wikipedia.org/wiki/Template_processor</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Intro to Character Escaping</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p><em>Character escaping</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> is conceptually similar
to output encoding. Essentially an extra character indicates that
one or more following characters should be interpreted as text. Many
programming languages use the backslash character (\) as an escape
character. We will commonly find escape characters in strings that
need to include delimiters within themselves.</p>
<p>Consider the following JavaScript code:</p>
<pre id="fence-code-17" class="fence-code"><code>var escString = "I am a string with <span class="code-block-p">\"delimiters\"</span> inside!";
</code></pre>
<blockquote>
<p>Listing 15 - Sample JavaScript code with character escaping</p>
</blockquote>
<p>Like many other programming languages, JavaScript uses double quotes
(") as a string delimiter. If we want to include a double quote within
a string, we need to escape the double quote with a backslash (\").</p>
<p>Many SQL databases use a single quote (') as a string delimiter.
Some databases support escaping with a backslash. Others will "double
up" single quotes, using two single quotes next to each other for
escaping.</p>
<p>Some programming languages include functions, such as PHP's
<em>mysqli_real_escape_string()</em>,<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> that perform
character escaping for SQL statements. Even though these types
of functions may prevent some types of SQL injection, not all SQL
injection attacks require single quotes. Additionally, there are
more robust solutions to prevent SQL injection, such as parameterized
queries, which we'll review later in this module.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Escape_character" target="_blank">https://en.wikipedia.org/wiki/Escape_character</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2021), <a href="https://www.php.net/manual/en/mysqli.real-escape-string.php" target="_blank">https://www.php.net/manual/en/mysqli.real-escape-string.php</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>File Handling</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand how to validate file extensions and formats</li>
<li>Understand how to normalize file paths</li>
<li>Understand the importance of deciding where files are stored.</li>
</ol>
<p>Whether allowing users to upload files or retrieve files from
disk, applications need to handle file operation securely to
prevent vulnerabilities. When applications do not handle uploaded
files securely, attackers can potentially overwrite configuration
files or upload malicious files, such as malware or <em>web
shells</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> If an application accesses local files based
on user-supplied input without proper input validation, attackers
might be able to use a <em>directory traversal attack</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> to
access arbitrary files on the web server.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Web_shell" target="_blank">https://en.wikipedia.org/wiki/Web_shell</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/Directory_traversal_attack" target="_blank">https://en.wikipedia.org/wiki/Directory_traversal_attack</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div></section></div><!---->

<h2>Validate File Format and Extensions</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Applications should validate the file format and extension when
uploading or retrieving a file. An application might check the file
extension as a first step. Developers will often implement this sort
of logic in client-side controls, which will prevent an average user
from uploading the wrong file type. However, attackers can spoof
or modify file extensions. Applications should enforce this logic
server-side.</p>
<p>For example, we could use a simple JavaScript example to parse file
names that contain multiple periods:</p>
<pre id="fence-code-18" class="fence-code"><code>&gt; var filename = "fake.jpg.exe";
undefined
&gt; filename.includes("jpg");
true
&gt; filename.endsWith("jpg");
false
</code></pre>
<blockquote>
<p>Listing 16 - Using JavaScript to check if a string contains or ends with a value</p>
</blockquote>
<p>If an application uses the <em>include()</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> method to
check for a given file extension, in this case "jpg", the function
will return true. However, the actual file extension is "exe". The
<em>endsWith()</em> method returns false when we check if the string ends
with "jpg".</p>
<p>This example used string methods to check the extension. Some
programming languages have file-specific classes or functions that can
parse a string by file path, file name, and file extension, such as
Python's <em>os.path</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> module. These functions tend to
be more robust than implementing file extension checks based on string
manipulations. However, it is important to review and understand how
these functions work in our programming language of choice and what
configuration options we might need to provide when invoking the
functions.</p>
<p>Applications can also verify a file's format by checking its
signature.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> Not every file format has a well-known or
defined signature. Applications can check a file signature by reading
the bytes at the start of a file or by using a dedicated library to
handle the check. The <em>file</em><sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> command on most Linux systems
performs this check as well.</p>
<pre id="fence-code-19" class="fence-code"><code>kali@kali:~$ file example.txt 
example.txt: ASCII text
kali@kali:~$ file example.jpg
example.jpg: ASCII text
kali@kali:~$ file example.pdf
example.pdf: PDF document, version 1.4
</code></pre>
<blockquote>
<p>Listing 17 - Using the file command to check files types</p>
</blockquote>
<p>While useful, the file command requires a file already written to
disk, but some applications can inspect file signatures in memory
before writing a file to disk.</p>
<p>Applications should reject uploads that do not match the expected
file formats. Likewise, if an application retrieves a file from disk
for a user, the application should verify the file format matches the
expected type. In both cases, the application should reject any file
that does not pass the validation checks.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Mozilla, 2021), <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes" target="_blank">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/includes</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Python Software Foundation, 2021), <a href="https://docs.python.org/3/library/os.path.html" target="_blank">https://docs.python.org/3/library/os.path.html</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/List_of_file_signatures" target="_blank">https://en.wikipedia.org/wiki/List_of_file_signatures</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/File_(command)" target="_blank">https://en.wikipedia.org/wiki/File_(command)</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Path Normalization</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Attackers may attempt to manipulate file paths by including relative
pathing characters (../) or including absolute file paths to access
files in other directories. Therefore, when dealing with reading
or writing files, applications should normalize file paths before
performing any other action. The process of normalizing a file path
resolves any relative pathing to create an absolute file path.</p>
<p>Most programming languages include functions that can normalize file
paths. For example, we can use <em>os.path.normpath()</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>
to normalize a file path in Python:</p>
<pre id="fence-code-20" class="fence-code has-commands"><code>kali@kali:~$ <span class="code-block-ui">python3</span> 
Python 3.8.6 (default, Sep 25 2020, 09:36:53) 
[GCC 10.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; <span class="code-block-ui">import os</span>
&gt;&gt;&gt; <span class="code-block-ui">os.path.normpath("/foo/../bar")</span>
<span class="code-block-p">'/bar'</span>
&gt;&gt;&gt; 
</code></pre>
<blockquote>
<p>Listing 18 - Using os.path.normpath() to normalize a file path</p>
</blockquote>
<p>In Listing 18, the <em>os.path.normpath()</em> function
normalizes the path <span class="fp-block">/foo/../bar</span> to <span class="fp-block">/bar</span>.</p>
<p>Once an application has normalized the file path, it should check
if that path is a valid location using an allowlist. Sometimes an
application will reject a request or parameter if it contains relative
pathing characters (../). This can be a useful security control but
normalizing paths and validating against an allowlist will also block
attacks that include absolute pathing.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Python Software Foundation, 2021), <a href="https://docs.python.org/3/library/os.path.html#os.path.normpath" target="_blank">https://docs.python.org/3/library/os.path.html#os.path.normpath</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>File Storage</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>When allowing file uploads, we must decide how to store the files.
The intended use-case of our application and the types of files
uploaded will influence this decision. If the user should be allowed
to directly browse to the uploaded file, we could store the file in the
web root or in publicly accessible storage (such as an S3 bucket).
However, storing files in the web root can be dangerous if the
application server can execute the code contained in the files. For
example, an application written in PHP that allows users to upload
any files to the web root will likely be vulnerable to remote code
execution through an uploaded web shell.</p>
<p>If we need to restrict access to the uploaded files, we should
write the files outside the web root so that they cannot be directly
accessed. Instead, our application can determine which users can
access the files and return the file contents to them. When doing so,
the application must include the correct content-type to prevent the
browser from mishandling the response.</p>
<p>When saving files locally, the application should generate a unique
file name instead of using the user-supplied name. Renaming the file
adds another layer of complexity for attackers to directly access
an uploaded file and prevents the uploaded file from overwriting an
existing file.</p>
</div><!----></div>

<!----><div><h2>Parameterized Queries</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand the basics of SQL injection vulnerabilities</li>
<li>Understand the importance of parameterized queries</li>
<li>Understand how to write parameterized queries</li>
</ol>
</div><!---->

<h2>Intro to SQL Injection</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>When dealing with a database, input validation alone may not
afford sufficient protection from attack since SQL statements
mix commands with data. As such, if an application dynamically
constructs SQL queries with user-supplied input, an attacker may
be able to manipulate queries to change their meaning or extract
data from the database. These sorts of attacks are known as <em>SQL
injection</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> and can lead to complete server compromise.</p>
<p>SQL injection usually occurs when applications build SQL queries from
user-supplied input. Consider the following example written in PHP:</p>
<pre id="fence-code-21" class="fence-code"><code>$username = trim($_POST['username']);
$sql = "SELECT username, password FROM users WHERE username = '" . $username . "'";
</code></pre>
<blockquote>
<p>Listing 19 - Sample PHP code with SQL query</p>
</blockquote>
<p>In this example, the code populates the value of <em>$username</em> from
a POST body. The code then concatenates the value into a string as
part of an SQL query. If a user submits the username "tom.jones", the
application generates the following SQL query:</p>
<pre id="fence-code-22" class="fence-code"><code>SELECT username, password FROM users WHERE username = '<span class="code-block-p">tom.jones</span>'
</code></pre>
<blockquote>
<p>Listing 20 - Generated SQL statement</p>
</blockquote>
<p>This is most likely the sort of query that the developer expected
while writing the code. However, let's suppose a user submits the
username <span class="pr-block">"tom.jones' or 'a'='a"</span>. The application will then
generate the following query:</p>
<pre id="fence-code-23" class="fence-code"><code>SELECT username, password FROM users WHERE username = '<span class="code-block-p">tom.jones' or 'a'='a</span>'
</code></pre>
<blockquote>
<p>Listing 21 - SQL statement with injection payload</p>
</blockquote>
<p>Because the code concatenates the value directly into the query, the
query's meaning has changed due to the additional OR clause, resulting
in a query that will return all records from the users table. Our
first instinct may be to apply input validation on the <em>$username</em>
variable. Input validation is an important security control, but
it cannot prevent all instances of SQL injection. We should still
validate data before storing it in a database, but we shouldn't rely
on validation alone to prevent SQL injection. Let's consider another
example in PHP.</p>
<p>The <em>mysqli::real_escape_string()</em> function in PHP escapes special
characters in a string. According to the documentation:</p>
<p><span class="qu-block">Characters encoded are NUL (ASCII 0), \n, \r, , ', ", and
Control-Z.</span></p>
<p>This function would be suitable for our previous example. The single
quotes would be encoded and therefore they would not allow us to
maliciously modify the query. However, consider the following example:</p>
<pre id="fence-code-24" class="fence-code"><code>$id = trim($_POST['id']);
$sql = "SELECT username, password FROM users WHERE id = " . $id;
</code></pre>
<blockquote>
<p>Listing 22 - Another sample of PHP code with SQL query</p>
</blockquote>
<p>If the <em>$id</em> variable is intended to be an integer value, it does
not need to be surrounded by quotes in a SQL query. If an application
doesn't validate that the variable contains an integer value or
explicitly cast the value to an integer, this could would also
be vulnerable to SQL injection even if the <em>real_escape_string()</em>
function is used. Since the value isn't quoted in the SQL query, a SQL
injection payload would also not require quotes.</p>
<p>Fortunately, we can use <em>parameterized queries</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> to
prevent SQL injection.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2021), <a href="https://en.wikipedia.org/wiki/SQL_injection" target="_blank">https://en.wikipedia.org/wiki/SQL_injection</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(CheatSheet Series Team, 2021), <a href="https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Intro to Parameterized Queries</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Most programming languages and frameworks support parameterized
queries. Some languages refer to these as <em>prepared
statements</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> Regardless of what a programming
language calls them, these queries use parameters, or placeholders,
to mark where values will be supplied when the query is executed.
By marking parameters in this way, the SQL interpreter has a clear
delineation between the SQL query itself and any parameters. The
database compiles the query separately and then binds the parameters
at run time. Parameterized queries, when used properly, are very
effective at preventing SQL injection attacks.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Oracle, 2021), <a href="https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html" target="_blank">https://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Parameterized Query Syntax</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>The syntax for a parameterized queries is different than the queries
we examined in the previous section. Let's review an example in PHP.</p>
<pre id="fence-code-25" class="fence-code"><code>$stmt =  $conn-&gt;prepare('INSERT INTO users(username, password) VALUES (?, ?)');
$stmt-&gt;bind_param('ss',$username, $passwordhash);
$stmt-&gt;execute();
$stmt-&gt;close();
</code></pre>
<blockquote>
<p>Listing 23 - Another sample of PHP code with SQL query</p>
</blockquote>
<p>First, we need to call <em>prepare()</em> with our SQL statement. Instead of
placing the variables in the SQL query, we use question marks as place
holders. Next, we call <em>bind_param()</em> on the resulting <em>$stmt</em> object
and pass in a string that defines the variable types ('ss' for two
strings in this case) followed by the variables. The variables will be
used in the order the are passed in. In other words, <em>$username</em> will
correspond to the first parameter and <em>$passwordhash</em> to the second.
We call <em>execute()</em> to execute the SQL query and then call <em>close()</em>
to close our connection.</p>
<p>Some languages also support naming the parameters in the query by
prefixing the names with colons (:).</p>
<pre id="fence-code-26" class="fence-code"><code>$stmt =  $conn-&gt;prepare('INSERT INTO users(username, password) VALUES (:username, :passwordhash)');
$stmt-&gt;bind_param(':username',$username);
$stmt-&gt;bind_param(':passwordhash',$passwordhash);
</code></pre>
<blockquote>
<p>Listing 24 - Using named parameters in a SQL query</p>
</blockquote>
<p>When a programming language supports named parameters,
they are typically bound individually as shown in Listing
24. However, some programming languages or
frameworks may have different implementations.</p>
<p>While parameterized queries may require more upfront development time
compared to dynamically generating queries, they are essential to
preventing critical vulnerabilities.</p>
</div><!----></div>