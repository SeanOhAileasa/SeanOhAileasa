<!----><div><h1>Web Session Management</h1>
<p>In this Learning Module, we will cover the following Learning Units:</p>
<ul>
<li>Authentication and authorization</li>
<li>Password comparison and storage</li>
<li>Web HTTP session basics</li>
<li>Introduction to cookie security</li>
<li>Single sign-on (SSO)</li>
</ul>
<p>Traffic between a web server and a client is commonly over HTTP or
HTTPS. The traffic can contain numerous HTTP Request and Response
packets. There is session management tracking at multiple protocol
levels during these interactions. In this module, we will introduce
some concepts related to HTTP session tracking.</p>
<p>Let's think about a time we visited a website and clicked on different
buttons. Maybe browsing a store that requested our home continent or
selecting the language the website content would be presented in. Once
we made our selection, the web server provided the appropriate web
page.</p>
<p>If we closed and reopened the browser tab and navigated back to that
site, chances are the website would not ask us those initial questions
again (though, this would depend on other factors like web server and
browser configuration). The web browser would likely remember what
we previously selected and automatically redirect to the main portion
of the website. This is possible because of <em>session management</em>, or
unauthenticated session tracking in our example.</p>
<p>Another example is when we browse to a website that requires login
credentials to access certain sections. Once we provide the correct
credentials, we are able to navigate throughout authenticated portions
of the website. Again, this is due to session management, but this
time around, it is considered authenticated session management.</p>
<section class="sb-block"><p>There is also behind-the-scenes session management on the server
side that is not visible to the end user. We will not be focusing on
the server side components in this module.</p></section>
<p>Without HTTP session management, the web server might have to
authenticate the client for every web request, which may not be an
enjoyable user experience.</p>
<p>In this module, we are going to analyze what HTTP browser session
tracking means from a technical perspective. We will also point
out security concerns and ways to address them. As cyber security
professionals, it is very important to understand the risks, and
mitigation techniques, associated with session management.</p>
</div><!---->

<!----><div><h2>Authentication and Authorization</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Compare and contrast authentication vs authorization</li>
<li>Understand the importance of session management</li>
</ol>
<p>In this Learning Unit, we are going to discuss the differences between
authentication and authorization and how they are related to each
other. We are also going to explain how each process connects to
session management.</p>
</div><!---->

<h2>Authentication vs Authorization</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p><em>Authentication</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> and
<em>Authorization</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> sound similar but are two
different aspects. While they are closely related, both processes
serve slightly different purposes.</p>
<p>Authentication is the process of confirming the identity of a user
or system. Similar to providing ID at the airport, we are essentially
showing proof that we are who we say we are. Authentication can also
happen for systems such as websites, digital documents, or physical
things. In terms of user authentication, once an identity has been
verified, access to resources is allowed based on authorization.</p>
<p>Authorization controls access to resources. Once the system has
verified the user, the system determines what resources the user has
access to. Although access control can refer to users and systems,
both physical and digital, in this module, our focus will be on users.</p>
<section class="sb-block"><p><em>Access control</em> and access policies<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> is a
whole subdomain of information security, which we will not discuss in
depth here.</p></section>
<p>Authentication occurs before authorization. One way of thinking about
authentication is that someone has to be confirmed as "authentic"
before authorizing access.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Authentication" target="_blank">https://en.wikipedia.org/wiki/Authentication</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Authorization" target="_blank">https://en.wikipedia.org/wiki/Authorization</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Access_control" target="_blank">https://en.wikipedia.org/wiki/Access_control</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Session Management</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>In the previous section, we learned that authentication confirms the
identity of a user or system. Authorization uses rules or policies
to provide access to resources. In order for authentication and
authorization to be effective and enjoyable for users, we use session
management.</p>
<p>Let's imagine that we go to the bank to withdraw cash. The teller asks
us for an ID, which we provide to authenticate. Then, they inform us
that we are authorized to withdraw or deposit money into our account.
They ask us how much money we want to withdraw and we reply "$100".
Imagine if they asked again for our ID for authentication before
giving us the money. This would get very annoying, very quickly.</p>
<p>This analogy can be applied to a user logging in to their bank account
online. If the web server required the user to authenticate every time
a button is clicked, the website wouldn't be user friendly.</p>
<p>This is one of the many reasons why session tracking is desired.
A <em>session</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> is when two or more devices communicate
during a certain period of time. As mentioned earlier, the key point
about sessions is that they are usually <em>stateful</em>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup>
That means there is some level of tracking information between the
systems in order to maintain a state. Back to our bank analogy, once
the bank teller initially authenticated our identity, they would not
need to authenticate us again for the duration of our "session", or
our time communicating. A more practical example is when a user logs
in to their bank account online. Depending on different factors,
that session is stateful, or managed, and the user does not have to
constantly authenticate.</p>
<p>The unauthenticated session management process begins prior to
authentication. For instance, maybe we are browsing a store website
and find an item. Let's say we increase the quantity to two, add it
to our cart, and then click the cart page button. The server may want
to keep track of the interaction and respond by displaying those two
items that were added to the cart when the cart page is queried.</p>
<p>In terms of authenticated session management, the concept is basically
the same. There are slight differences, but the server still has
to keep track of the current interaction. The authenticated session
management process occurs after authentication has been successfully
verified.</p>
<p>Let's continue exploring how password comparison and storage works
during the authentication process.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Session_(computer_science)" target="_blank">https://en.wikipedia.org/wiki/Session_(computer_science)</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/State_(computer_science)" target="_blank">https://en.wikipedia.org/wiki/State_(computer_science)</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Password Comparison and Storage</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand how web servers store credentials</li>
<li>Provide a technical explanation of the authentication process</li>
</ol>
<p>In this section, we will get a better understanding of how web
applications might store credentials and then further explain the
authentication process.</p>
</div><!---->

<h2>Web Application Credential Storage</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>In some cases, credentials are stored in the source code of the web
application. When a user provides the credentials, the web application
would compare the user input with the <em>hard-coded</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>
credentials. If there is a match, the web application would
authenticate the user and allow access. Otherwise, the web application
would deny access. Security practitioners identified that hard-coding
credentials is often vulnerable. There are numerous methods that
allow unauthorized individuals to access source code and view the
credentials in different scenarios.</p>
<p>Databases are one concept that can help address this issue. A
<em>database</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> is collection of information, or data,
structured in an organized manner that generally aids in information
retrieval and data usability. While databases were not specifically
created to store credentials, they did gain popularity as a way to do
so. Databases can help protect against the potential vulnerabilities
of hard-coded credentials in web application source code, but it does
create other vulnerabilities specific to databases. Our focus in this
module is not learning about different database types, but instead
focusing on ways that credentials might be stored in databases,
regardless of the specific database type or <em>Database Management
System</em> (DBMS).<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></p>
<p>Although it's not typically implemented anymore due to insecurity,
<em>plaintext</em><sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> is a way to store credentials. This
is data that is unencrypted and by far the worst method to store
credentials. A database table with plaintext credentials is something
like this.</p>
<table>
<thead>
<tr>
<th>username</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin</td>
<td>CipherRocks</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Table 1 - Plaintext credentials</p>
</blockquote>
<p>Plaintext is not secure because anyone that can view the data can view
the credentials. Another approach to discuss is encrypted credentials.
<em>Encryption</em><sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup> uses a <em>cipher</em><sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup> with
an <em>encryption key</em>,<sup class="footnote-ref"><a href="#fn7" id="fnref7">7</a></sup> which transforms the
plaintext into <em>ciphertext</em>.<sup class="footnote-ref"><a href="#fn8" id="fnref8">8</a></sup> Encryption falls under
<em>cryptography</em>,<sup class="footnote-ref"><a href="#fn9" id="fnref9">9</a></sup> which is a whole domain that one
can specialize in.</p>
<section class="sb-block"><p>For this module, we will only review the basics of a few
cryptographic concepts. Because the terms and ideas are complex, we
will not fully be covering them here.</p></section>
<p>Encrypting and decrypting data is supposed to provide more secure
communication or storage. There are different types of encryption
methods, but the critical thing is that encryption is a reversible
process by design. This idea of protecting the encryption key through
proper key management and storage plays a very important role in
cryptographic implementations.</p>
<p>Let's inspect an example, called <em>ROT13</em>,<sup class="footnote-ref"><a href="#fn10" id="fnref10">10</a></sup> which is a
subset of a <em>Caesar cipher</em>.<sup class="footnote-ref"><a href="#fn11" id="fnref11">11</a></sup> A Caesar cipher is
a type of substitution cipher, and although neither ROT13 or Ceasar
ciphers are usable encryption, they are both trivially broken and
should not be used. Rather than using a substitution cipher, we would
normally use a <em>block cipher</em>.<sup class="footnote-ref"><a href="#fn12" id="fnref12">12</a></sup></p>
<section class="sb-block"><p>A <em>substitution cipher</em><sup class="footnote-ref"><a href="#fn13" id="fnref13">13</a></sup> replaces
plaintext with ciphertext by using a key map to substitute each
character of the message with a mapping as instructed by the key.
Substitution ciphers are generally insecure and can be broken with
differential cryptanalysis. Differential cryptanalysis works by
measuring the difference between each character of the ciphertext,
resulting in mapping used by the key being uncovered.</p>
<p>Most secure ciphers have more steps than just substitution and
use multiple rounds of permutations with a key that has specific
properties to make the cipher text indistinguishable from random
data. Secure ciphers may also ensure other properties, such as
non-malleability, that are desired for security.</p></section>
<p>Below, we have a message followed by a "key". The key is displayed on
two lines. The first line is the alphabet from a-z. The second line is
the alphabet again, but starts at "n" and ends with "m". In this case,
we can say that the alphabet has shifted 13 characters and each letter
of the first line matches a different letter on the second line.</p>
<pre id="fence-code-3" class="fence-code"><code>"my super secret password is password"

a b c d e f g h i j k l m n o p q r s t u v w x y z
n o p q r s t u v w x y z a b c d e f g h i j k l m
</code></pre>
<blockquote>
<p>Listing 1 - Message and key</p>
</blockquote>
<p>Let's take each letter in our message, find it on the first line of
the key, and change it to the corresponding letter on the second line
of the key. For example, the letter "m" becomes the letter "z".</p>
<pre id="fence-code-4" class="fence-code"><code>"zl fhcre frperg cnffjbeq vf cnffjbeq"
</code></pre>
<blockquote>
<p>Listing 2 - Encrypted message</p>
</blockquote>
<p>The encrypted message appears scrambled. This same idea can be applied
to credentials. If the encryption method used above was implemented,
the database table could be something like this for the password of
"CipherRocks".</p>
<table>
<thead>
<tr>
<th>username</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin</td>
<td>PvcureEbpxf</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Table 2 - Weak encrypted password</p>
</blockquote>
<p>That is one example of encryption, although weak encryption. Even weak
encryption is more secure than plaintext passwords. A better cipher
to use would be the block cipher <em>AES</em>.<sup class="footnote-ref"><a href="#fn14" id="fnref14">14</a></sup> Ciphers are used in
different ways depending on the situation. For example, they are used
in another type of cryptographic function called <em>hashing</em>.</p>
<p>A <em>hash function</em><sup class="footnote-ref"><a href="#fn15" id="fnref15">15</a></sup> transforms input data into a
fixed-length of bits (often to hexadecimal numbers and letters).
In cryptography, a <em>hash</em> refers to the output of a one-way hashing
algorithm that transforms the input (typically by using similar
transformations as encryption but without the ability to decrypt or
reverse the process).<sup class="footnote-ref"><a href="#fn16" id="fnref16">16</a></sup> Hashing is one-way,
because, unlike encryption, hash functions do not have a key and a
decryption function. If a hash function is reversible, then it is
likely not usable and should likely be treated as broken. Rather than
decrypting a hash, we "check" hashes by supplying the input to the
hash function to check if the result matches.</p>
<p>Let's examine an example using the <em>MD5</em><sup class="footnote-ref"><a href="#fn17" id="fnref17">17</a></sup> hash function.
Although MD5 is less secure than other hash functions in many
contexts, it is widely known and provides a quick starting point to
explain the idea of hashing. We will use the <em>md5sum</em> program, which
comes pre-installed with Kali. We will <strong>echo</strong> our "CipherRocks"
password and pipe it to <strong>md5sum</strong> as input.</p>
<pre id="fence-code-5" class="fence-code has-commands"><code>kali@kali:~$ <span class="code-block-ui">echo "CipherRocks" | md5sum</span>
<span class="code-block-p">ae1ee2fbdc29a11e05ae31ff9dc7a735</span> -
</code></pre>
<blockquote>
<p>Listing 3 - Using md5sum to hash plaintext password</p>
</blockquote>
<p>The result is a new value, which is the MD5 hash of the input
"CipherRocks", including a newline from the echo command. This md5sum
value is always the same for the exact string and newline and if
we change anything, a different hash value will be returned. Let's
run this same command on the exact string and then alter the string
slightly and review the results.</p>
<pre id="fence-code-6" class="fence-code"><code>kali@kali:~$ echo "Cipher<span class="code-block-s">R</span>ocks" | md5sum
<span class="code-block-p">ae1ee2fbdc29a11e05ae31ff9dc7a735</span> -

kali@kali:~$ echo "Cipher<span class="code-block-s">r</span>ocks" | md5sum
<span class="code-block-p">cb8bf6632622853d14410e3e2b5b34c2</span> -
</code></pre>
<blockquote>
<p>Listing 4 - Using md5sum to hash different strings</p>
</blockquote>
<p>Here, we observe that if we make any manipulations to the input,
such as changing the uppercase "R" to a lowercase "r", the value is
completely different. Hashes should be unique to the bytes used as
input. Two different inputs resulting in the same hash is a collision,
which is an indication of a problem with that hash function.</p>
<p>Let's examine how this method would change the database table.</p>
<table>
<thead>
<tr>
<th>username</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin</td>
<td>ae1ee2fbdc29a11e05ae31ff9dc7a735</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Table 3 - Hashed password</p>
</blockquote>
<p>Now, when the web application receives the user's plaintext password,
like "CipherRocks", the web application will convert the plaintext
password to an MD5 hash and compare the returned hash value to the
value in the table for that user. If someone is able to attain or view
the hashed values, unlike encryption, they cannot reverse the process
without knowing or guessing the input to the hash function.</p>
<p>A more realistic hash function to use for passwords is
<em>Argon2</em><sup class="footnote-ref"><a href="#fn18" id="fnref18">18</a></sup> or <em>yescrypt</em><sup class="footnote-ref"><a href="#fn19" id="fnref19">19</a></sup>. MD5 may have
some use for manual checksums, but is not appropriate for password
hashing. The default password hashing at the time of this writing
in many Unix-based systems is <em>SHA-512</em>.<sup class="footnote-ref"><a href="#fn20" id="fnref20">20</a></sup>, but yescrypt
is being adopted as the default. Other systems such as OpenBSD use
<em>bcrypt</em><sup class="footnote-ref"><a href="#fn21" id="fnref21">21</a></sup> by default for password hashing. The hashing
algorithm used for a given web application may vary.</p>
<p>No matter the algorithm used, hashes are only as secure as the
input to them. If the input to the hash function was a small English
word, then we can guess the value with relative ease. We can have a
collection of hashes that contain words within the English dictionary.
Then, we can compare the hash against each hash in our collection
until we have a hit.</p>
<section class="sb-block"><p>There's a lot more to this hash comparison idea. It used to be
popular to use a <em>Rainbow Table</em>,<sup class="footnote-ref"><a href="#fn22" id="fnref22">22</a></sup> a table of known
hashes used to check the strength of password hashes; however, that
technique is typically not useful with more modern systems and will
not be a focus in this module.</p></section>
<p>Another element we will mention is using a construction
called a <em>salt</em>.<sup class="footnote-ref"><a href="#fn23" id="fnref23">23</a></sup> A salt is a value that is
<em>concatenated</em>,<sup class="footnote-ref"><a href="#fn24" id="fnref24">24</a></sup> or added, to a password prior
to hashing as part of the hashing process. There are various ways
to implement salting. For example, we can hash a password+salt, a
salt+password, or the result of either and then concatenate the salt.</p>
<p>In order to explain the basics, we will only cover a simplified
hashing of a password+salt. We would also want to use a different hash
algorithm than our example to improve security, as MD5 is not secure.
Let's examine a naive example below where we use a made-up value as a
salt.</p>
<pre id="fence-code-7" class="fence-code"><code>Password = "CipherRocks"
Salt Value = "SecretSalt"
MD5 value of "CipherRocksSecretSalt" = 350436d94a2d4d9359781549c98c97a1
</code></pre>
<blockquote>
<p>Listing 5 - MD5 Value of Password+Salt</p>
</blockquote>
<p>In the example above, we took the MD5 value of the concatenated
version of the password and the salt. One note: order matters. If we
swap the order of the password and salt and hash it, we will get a
different hash value.</p>
<pre id="fence-code-8" class="fence-code"><code>Password = "CipherRocks"
Salt Value = "SecretSalt"
MD5 value of "SecretSaltCipherRocks" = c4cd4eb457df986299e00c2c879e22d3
</code></pre>
<blockquote>
<p>Listing 6 - MD5 Value of Salt+Password</p>
</blockquote>
<p>As expected, the MD5 hash value is different. Salting creates a layer
of defense against using something like a Rainbow Table to identify
a hashed password. Rather than using Rainbow Tables, most hash
brute forcing is done with tools that can extract and use the salt
while making rapid guesses, such as <em>John the Ripper</em><sup class="footnote-ref"><a href="#fn25" id="fnref25">25</a></sup> and
<em>Hashcat</em>.<sup class="footnote-ref"><a href="#fn26" id="fnref26">26</a></sup></p>
<p>A potentially stronger implementation is to generate a random salt for
each different password that is used (or any time a password is set or
changed). A salt can be created separately using various programming
languages or with the same software that hashes based on the hash
algorithm specifications. Even if the same exact password is used
(by different users for example), a different and random salt applied
to it will make the two resulting hashes different. If we manually
create the salt, we also need to store it in a way so that it can be
retrieved when the hash needs to be checked.</p>
<p>Let's take the random salt idea and manually apply that to our
database table example. Let's assume the randomly generated salt is
"0Fsi39fjdksFGSHDosd304DS". We then concatenate this to our previously
used password, creating "0Fsi39fjdksFGSHDosd304DSCipherRocks".
Then, we can take the MD5 hash of that value, resulting in
"9bd95586bfb103f51b2e1e350d42c97d".</p>
<pre id="fence-code-9" class="fence-code has-commands"><code>kali@kali:~$ <span class="code-block-ui">echo "0Fsi39fjdksFGSHDosd304DSCipherRocks" | md5sum</span>
<span class="code-block-p">9bd95586bfb103f51b2e1e350d42c97d</span>  -
</code></pre>
<blockquote>
<p>Listing 7 - MD5 Value of RandomSalt+Password</p>
</blockquote>
<p>The database table would result in:</p>
<table>
<thead>
<tr>
<th>username</th>
<th>password</th>
</tr>
</thead>
<tbody>
<tr>
<td>admin</td>
<td>9bd95586bfb103f51b2e1e350d42c97d</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Table 4 - MD5 hash of Salt+Passowrd</p>
</blockquote>
<p>We manually added a salt in our example, but in a real implementation,
the salt is typically automatically managed by the hash function
implementation.</p>
<p>We discussed various methods of storing credentials into databases.
Storing hashes of credentials is generally better than storing
encrypted or plaintext credentials, but no matter which method is
used, weak passwords are always insecure.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Hard_coding" target="_blank">https://en.wikipedia.org/wiki/Hard_coding</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Database" target="_blank">https://en.wikipedia.org/wiki/Database</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Database#Database_management_system" target="_blank">https://en.wikipedia.org/wiki/Database#Database_management_system</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Plaintext" target="_blank">https://en.wikipedia.org/wiki/Plaintext</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn5"><sup>5</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Encryption" target="_blank">https://en.wikipedia.org/wiki/Encryption</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn6"><sup>6</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cipher" target="_blank">https://en.wikipedia.org/wiki/Cipher</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn7"><sup>7</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Key_(cryptography)" target="_blank">https://en.wikipedia.org/wiki/Key_(cryptography)</a> <a href="#fnref7" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn8"><sup>8</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Ciphertext" target="_blank">https://en.wikipedia.org/wiki/Ciphertext</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn9"><sup>9</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cryptography" target="_blank">https://en.wikipedia.org/wiki/Cryptography</a> <a href="#fnref9" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn10"><sup>10</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/ROT13" target="_blank">https://en.wikipedia.org/wiki/ROT13</a> <a href="#fnref10" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn11"><sup>11</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Caesar_cipher" target="_blank">https://en.wikipedia.org/wiki/Caesar_cipher</a> <a href="#fnref11" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn12"><sup>12</sup><p>(NIST, 2020) <a href="https://csrc.nist.gov/Projects/Block-Cipher-Techniques/BCM/Current-Modes" target="_blank">https://csrc.nist.gov/Projects/Block-Cipher-Techniques/BCM/Current-Modes</a> <a href="#fnref12" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn13"><sup>13</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Substitution_cipher" target="_blank">https://en.wikipedia.org/wiki/Substitution_cipher</a> <a href="#fnref13" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn14"><sup>14</sup><p>(ietf, 2001) <a href="https://datatracker.ietf.org/doc/html/rfc3565" target="_blank">https://datatracker.ietf.org/doc/html/rfc3565</a> <a href="#fnref14" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn15"><sup>15</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Hash_function" target="_blank">https://en.wikipedia.org/wiki/Hash_function</a> <a href="#fnref15" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn16"><sup>16</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cryptographic_hash_function" target="_blank">https://en.wikipedia.org/wiki/Cryptographic_hash_function</a> <a href="#fnref16" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn17"><sup>17</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/MD5" target="_blank">https://en.wikipedia.org/wiki/MD5</a> <a href="#fnref17" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn18"><sup>18</sup><p>(University of Luxembourg, 2015) <a href="https://www.password-hashing.net/argon2-specs.pdf" target="_blank">https://www.password-hashing.net/argon2-specs.pdf</a> <a href="#fnref18" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn19"><sup>19</sup><p>(openwall), <a href="https://www.openwall.com/yescrypt/" target="_blank">https://www.openwall.com/yescrypt/</a> <a href="#fnref19" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn20"><sup>20</sup><p>(NIST, 2015) <a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf" target="_blank">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf</a> <a href="#fnref20" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn21"><sup>21</sup><p>(Johnny Shelly, 2002) <a href="http://bcrypt.sourceforge.net/" target="_blank">http://bcrypt.sourceforge.net/</a> <a href="#fnref21" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn22"><sup>22</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Rainbow_table" target="_blank">https://en.wikipedia.org/wiki/Rainbow_table</a> <a href="#fnref22" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn23"><sup>23</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Salt_(cryptography)" target="_blank">https://en.wikipedia.org/wiki/Salt_(cryptography)</a> <a href="#fnref23" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn24"><sup>24</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Concatenation" target="_blank">https://en.wikipedia.org/wiki/Concatenation</a> <a href="#fnref24" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn25"><sup>25</sup><p>(Offensive Security, 2022) <a href="https://www.kali.org/tools/john/" target="_blank">https://www.kali.org/tools/john/</a> <a href="#fnref25" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn26"><sup>26</sup><p>(Offensive Security, 2022) <a href="https://www.kali.org/tools/hashcat/" target="_blank">https://www.kali.org/tools/hashcat/</a> <a href="#fnref26" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Authentication Process Introduction</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>As mentioned earlier, when a user logs in to a website, the server
will use the credentials provided to authenticate. Once authenticated,
the server and client will undergo an authenticated session management
process to maintain that interaction for a period of time. Before
we discuss details regarding that process, let's outline the
authentication process a little more.</p>
<p>To begin, a user provides some sort of information as credentials that
would uniquely identify them. Next, that data would be compared to
information that is stored, such as hashes within a database. Finally,
if there is a match, the server would authenticate the user. As
discussed in the previous section, an example would be a username and
a password. Once the user provides the username and password to the
server, the server compares that information to existing data.</p>
<p>For instance, a server might verify that the username exists by
running a query on the database. If there is a match, the server would
take the user provided password, apply a salt value to append before
the password, hash the result, and compare the value to the hash value
of the username that matched the previous result.</p>
<section class="sb-block"><p>This is only one example of many possible implementations that can
exist.</p></section>
<p>In terms of information provided by the user to authenticate, there
are three categories to outline. Let's break down each method:</p>
<ul>
<li><strong>Knowledge</strong>: something the user knows, like a password, personal
identification number (PIN), or security question</li>
<li><strong>Possession</strong>: something the user has, like an identification
(ID)/smart card, token (software/hardware), or phone/device</li>
<li><strong>Inherence</strong>: something the user is, like fingerprint, retina/iris,
facial recognition, voice, and biometric</li>
</ul>
<p>In general, one or more of these methods is used during the
authentication process. The user will provide data (password,
fingerprint, etc), and that data will be compared to data usually
located in a database. If there is a positive match, the system will
authenticate the user.</p>
<p>Single-factor authentication is considered less secure than
<em>two-factor authentication</em> (2FA) or <em>multi-factor authentication</em>
(MFA).<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> 2FA or MFA includes at least two methods from the
three categories. For example, we might provide a username/password,
followed by a code that was sent to our mobile phone. This method
of combining two or more authentication types makes MFA much more
difficult for attackers to gain unauthorized access by using something
like compromised credentials.</p>
<p>The last thing to highlight in this section is the <em>Transport Layer
Security</em> (TLS)<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> protocol. This protocol provides more secure
communication over a network. After a user provides the credentials to
a website, if there is no secure way to send that data from the client
to the server, that information could be compromised more easily.</p>
<section class="sb-block"><p>Like many security controls, TLS should not be the only control to
protect against attacks. TLS can provide encryption and identity. TLS
is only a piece of the computer security puzzle, specifically securing
communications across the network.</p></section>
<p>For the purpose of this module, we are going to briefly introduce TLS
to secure traffic between a client and a web server, like during the
authentication process. The lab example does not use TLS and we will
be exploring TLS further in different modules.</p>
<p>Let's outline the process called the <em>TLS
Handshake</em>.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> Before the TLS handshake we have
the <em>TCP three-way handshake</em>,<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup>. There are
many possible details related to the TLS handshake based on use
of different TLS protocols and configurations, including optional
configurations. To keep this explanation simple, we will only outline
the general steps.</p>
<ul>
<li>TCP three-way handshake establishes the network connection over TCP.</li>
<li>The client initiates the TLS conversation with a "client hello"
request, and may supply client authenticating certificate(s) and other
pre-shared information.</li>
<li>Server responds with the "server hello". If no TLS client
authentication is used, the server moves on and responds with its
certificate. If the client certificate is used, the server verifies
the client certificate against the client trust list and terminates
the connection if signature verification fails.</li>
<li>The client verifies the server is trusted against the client's trust
store.</li>
<li>The cipher selection is also agreed upon between the client and
server. If they are not compatible or the verification fails, the TLS
connection terminates. - Once each side has completed the required
verification and agreed on cipher, the cipher selection is used to
generate session keys and an encrypted communication tunnel for the
rest of the data.</li>
</ul>
<p>Note that the client and server also must agree on TLS protocol
version. At the time of this writing, TLSv1.3 and customized TLSv1.2
are the versions to use. By customized TLSv1.2, we mean that TLSv1.2
does contain less secure cipher settings, but can still be effective
if the weaker ciphers are disabled. TLSv1.1 and older are not
considered sufficiently secure anymore.</p>
<p>Once the TLS handshake is complete, user information, such as username
and password, can be sent between the client and server encrypted.
The session can leverage the encrypted tunnel to share all data during
that TLS session. TLS sessions have their own tracking and management.
We will not be covering TLS session management in this module.</p>
<p>TLS isn't always implemented, but it's usually recommended to provide
a secure communication over the network for things like logging into a
website.</p>
<p>Picking back up where we left off, our TLS handshake is complete so
let's review a common example of the authentication process.</p>
<ul>
<li>The TLS handshake is initiated and completed between the client and the
server.</li>
<li>User-provided credentials are encrypted and sent from the client to
the server.</li>
<li>The server compares the data received from the client to the data
located in a database.</li>
<li>If a match exists, the server authenticates the user.</li>
<li>The client and server begin the session management process.</li>
</ul>
<p>The authentication process is complex and a lot occurs prior to
starting the authenticated session management process. These technical
steps are important in understanding the overall process, which
encompasses unauthenticated session management, authentication,
authenticated session management, and authorization.</p>
<p>Next, we will learn about the basics of a session, such as HTTP
session ID properties, session expiration, and web browser storage.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Multi-factor_authentication" target="_blank">https://en.wikipedia.org/wiki/Multi-factor_authentication</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security" target="_blank">https://en.wikipedia.org/wiki/Transport_Layer_Security</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake" target="_blank">https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Handshaking#TCP_three-way_handshake" target="_blank">https://en.wikipedia.org/wiki/Handshaking#TCP_three-way_handshake</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Session Basics</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Explain HTTP session ID/Token properties</li>
<li>Describe session expiration</li>
<li>Learn about web browser storage</li>
</ol>
<p>Previously, we discussed the authentication process. We covered things
like the TLS handshake, types of authentication methods, and ways
credentials might be handled.</p>
<p>In this Learning Unit, we will cover the basics of an HTTP session.
Session management can exist before and after the authentication
process. The session management process is important because it allows
the server to maintain a persistent and unique interaction between the
server and the specific client.</p>
<p>In order to achieve this, certain information, such as session ID, can
be created. This information is used by the client and the server to
uniquely track client interaction.</p>
</div><!---->

<h2>HTTP Session IDs and Token Properties</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>The <em>session identifier (ID)</em>,<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> or <em>session token</em>
is a unique value that is used to identify a session. Session
IDs have certain properties that are important to know due to
security implications. Session-related attacks, such as <em>session
hijacking</em>,<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> are very prevalent if developers do
not consider security when creating a web application.</p>
<p>Session IDs can usually be identified by a "name=value" pair. Let's
review an example of a session ID.</p>
<pre id="fence-code-12" class="fence-code"><code>sessionID = myExampleSessionID123
</code></pre>
<blockquote>
<p>Listing 8 - Example session ID</p>
</blockquote>
<p>Some out-of-the-box web application frameworks have their own
session ID names, such as <em>PHPSESSID</em> for PHP.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup>
From an offensive standpoint, this is great information during the
reconnaissance phase. From a defensive perspective, we need to be
mindful what information the server can present to clients. This can
include data such as session ID names.</p>
<p>Session IDs are generated to be long and indistinguishable from random
data to improve the security against an adversary guessing session
IDs.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Session_ID" target="_blank">https://en.wikipedia.org/wiki/Session_ID</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Session_hijacking" target="_blank">https://en.wikipedia.org/wiki/Session_hijacking</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(PHP Tutorial, 2022), <a href="https://www.phptutorial.net/php-tutorial/php-session/" target="_blank">https://www.phptutorial.net/php-tutorial/php-session/</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Session Expiration</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>In this section, we will quickly discuss the potential life cycle
of session IDs. From a security perspective, web servers should
only accept IDs for valid sessions. This may not always be the
case. Some web servers may accept client-side generated session IDs,
allowing manipulation from an adversary. Allowing web browsers to
specify the session ID can lead to things like <em>session fixation
attacks</em>.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup></p>
<p>Session expiration is an important part of session management.
There are various configurable timers that should balance security
with business impact. Sessions need to expire, otherwise they
are not really a session. Session IDs that don't forcefully expire
can lead to endless sessions that might lead to a vulnerability.</p>
<p><em>Idle</em> timeout takes activity into account and defines when a
session expires based on activity. For example, if the client does
not interact with the server, the timer starts. If the session is
idle for a certain time, the session expires. This timeout is more
effective compared to not having any timeout, but idle timeouts are
not necessarily as effective as an absolute timeout.</p>
<p>An <em>absolute</em> timeout is the finite time before an active session
expires and requires the client to either re-authenticate or reset
the session. For instance, let's say we visit a store website with
an absolute timeout. The second that session is initiated, we have
60 minutes before it expires. During that time, we add things to
our cart. If we don't checkout before the session hits the absolute
timer, we risk our session expiring. This can result in the removal of
our items in our cart because the server would not continue to track
that an expired session. An absolute timeout is generally applied to
authenticated sessions.</p>
<p>For example, if we authenticate to access our bank account, an
absolute timer of 30 minutes might exist. After 30 minutes, our
authenticated session would expire, requiring us to authenticate
again. This timeout method can be more effective in combating certain
session attacks.</p>
<p>Similar to generating the session ID, the server should maintain
these timeout values. Attackers can take advantage of servers that
accept client-side timeout values by manipulating the timeout, which
may render the security measure completely ineffective.</p>
<p>There are other ways a session can expire. If the privilege level
changes, a best practice is to expire the current/previous session
and generate a new session and related IDs. For example, an
unauthenticated vs. authenticated session (upon login), or logging in
as a low privilege user vs an administrator user for a web portal. As
a security measure in these cases, a session ID should expire and a
new session ID should be created.</p>
<p>For authenticated sessions, if the user logs out, the server should
end that session. If the session only ends on the client-side, an
attacker can exploit this vulnerability by taking over the session.
By mimicking the old client and hijacking the session, the web server
will keep the session active.</p>
<p>Some people use browser plugins that store passwords or other
long-lived authorization data, sometimes known as a "remember me"
feature. Increasing the time of a session can increase security risks.
This type of feature is typically bad for security.</p>
<p>Some sites will have a pop up that informs the user of a forced log
off. The pop up box may have a live timer or may include the local
time of when the session expires.</p>
<p>Lastly, we will mention <em>session ID caching</em>. A <em>cache</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup>
is a concept that stores data meant to be accessed later to speed
up the operation. Specifically, <em>web caching</em><sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> occurs
when information from web servers is stored on the client. This
helps with things like reducing network traffic and bandwidth as well
as increasing browsing speed. Depending on factors such as how web
browsers are configured, session IDs could be cached client-side.</p>
<p>Let's review an example where an attacker has a low privilege account
to a personal computer. On this computer, the owner browses to a bank
site and the session ID is cached client-side. The attacker could
use that information to hijack the session, even after the user logs
out. This would depend on other factors, but it is a possibility
nonetheless. To prevent something like this from happening, caching
session IDs should be avoided unless there is a clear operational or
legal necessity.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Session_fixation" target="_blank">https://en.wikipedia.org/wiki/Session_fixation</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cache_(computing)" target="_blank">https://en.wikipedia.org/wiki/Cache_(computing)</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cache_(computing)#Web_cache" target="_blank">https://en.wikipedia.org/wiki/Cache_(computing)#Web_cache</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Web Browser Storage</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>Now that we have a better understanding of HTTP session management,
let's discuss some ways browsers can store session data. Depending
on factors such as purpose, browser, and client-side capabilities,
there are many ways to cache our web-related data in the browser.
Because having a deep understanding of storage mechanisms takes time
and practice, we won't cover all the ways to achieve this, but we will
introduce some related concepts.</p>
<p>In this section, we will focus on two specific <em>web storage</em>
mechanisms.<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> Web storage serves a similar purpose as
cookies, which we will cover in the next Learning Unit, but there are
some differences. Web storage allows web applications to store data,
such as session management information, in the browser on the client
side. Cookie sizes are generally limited to four kilobytes (KB),
while web storage (depending on the browser type and version) can be
anywhere between 5-10 megabytes (MB).</p>
<p>For this short demonstration, we are going to use Mozilla Firefox.
Accessing this information on other browsers will require similar
steps with slight differences. First, let's launch the browser and
open a new tab. Then, we will right-click on the page and select
<em>Inspect</em> to open up the <em>Page Inspector</em>.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_session_management/dd2bc90edea61bccc9fa288dda7e6b98-ssm_001_openPageInspector.png" alt="Figure 1: Right-Click and select Inspector to open Page Inspector">
<figcaption>Figure 1: Right-Click and select Inspector to open Page Inspector</figcaption>
</figure>
<p></p>
<p>The Page Inspector should be visible at the bottom of the browser
window and there are several tabs at the top of the Page Inspector
pane. One is labeled <em>Storage</em>.<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup></p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_session_management/0baeb65334a517e1fff647e1bee3832e-ssm_002_clickStorageTab.png" alt="Figure 2: Click Storage tag">
<figcaption>Figure 2: Click Storage tag</figcaption>
</figure>
<p></p>
<p>On the left hand side, we observe several storage types located in the
storage tree. We will review cookies in the next Learning Unit. Now,
let's discuss <em>Local Storage</em> and <em>Session Storage</em>.</p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_session_management/0c2635da4f1f76767a443bfbaa003c61-ssm_003_storageOptions.png" alt="Figure 3: Storage options">
<figcaption>Figure 3: Storage options</figcaption>
</figure>
<p></p>
<p>If expanded, we can select one of the items and find that the
browser does not have any data at this point. This is because we are
inspecting a new tab and not interacting with any servers.</p>
<p>
</p><figure>
<img src="https://offsec-platform-prod.s3.amazonaws.com/offsec-courses/WEB-100/images/secure_session_management/5c78b76b7d4e91a0a6caeb169ccd6f3f-ssm_004_storageObject.png" alt="Figure 4: Storage object">
<figcaption>Figure 4: Storage object</figcaption>
</figure>
<p></p>
<p>Session storage (<em>sessionStorage</em>) maintains values related to a
session for the time that the browser is open. An example of session
storage is storing information for unauthenticated session management.
Like in the previous example where we visited a website and added
items to our cart, the data that tracks which items were added to our
cart can be stored in the session storage.</p>
<p>Local storage (<em>localStorage</em>) can maintain data after the browser is
closed, but when users select <em>clear browsing data</em>, the storage can
be removed. Local storage can also be removed by browser plugins and
code. Local storage can store information like the "remember me" data.
Even if we close and reopen the browser, it can keep track of that
information in the local storage.</p>
<p>The way items are stored depends on many other factors, such as
browser settings and web application configuration. The above examples
are just potential ways storage can be implemented. An instance where
storing data within those two buckets might be an exception is when we
use <em>incognito mode</em>, <em>in-private browsing</em>, or browsing in private.
In general, private browsing or incognito mode will not store values
in local storage. However, the browser and settings determine the
storage location.</p>
<p>For example, if we log in to an account while using incognito mode,
the browser may store data related to that authenticated session for
the duration of that session. If we close the browser (or tab), that
session will no longer be present because the data wouldn't be stored
in a persistent manner.</p>
<section class="sb-block"><p>Incognito mode generally allows users to browse the internet
without storing web or session-related data on the client machine in
a persistent manner. It is up to the browser developers to determine
how Incognito features work, but as of this writing they commonly
do not hide IP addresses or provide any security; they just prevent
long-lived trackers and storage from being saved.</p></section>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Web_storage" target="_blank">https://en.wikipedia.org/wiki/Web_storage</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Firefox Source Docs, 2022), <a href="https://firefox-source-docs.mozilla.org/devtools-user/page_inspector/how_to/open_the_inspector/index.html" target="_blank">https://firefox-source-docs.mozilla.org/devtools-user/page_inspector/how_to/open_the_inspector/index.html</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Firefox Source Docs, 2022), <a href="https://firefox-source-docs.mozilla.org/devtools-user/storage_inspector/index.html" target="_blank">https://firefox-source-docs.mozilla.org/devtools-user/storage_inspector/index.html</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Introduction to Cookie Security</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Understand the basics of HTTP cookies</li>
<li>Discuss HTTP cookie attributes</li>
</ol>
<p>In this Learning Unit, we will discuss cookies. Unfortunately, not
delicious baked cookies, but HTTP cookies, which serve a similar
purpose to web storage. There are disadvantages to using cookies when
used to store values for sessions.</p>
</div><!---->

<h2>HTTP Cookies</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p><em>HTTP cookies</em>,<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> also called web, internet, or browser
cookies, are used to store data related to sessions and/or to track
the user's activity on the web. When they are implemented, they they
are commonly included in every HTTP request.</p>
<section class="sb-block"><p>Why are they called cookies? Great question. Fortune cookies
are sugary treats that contain a short message written on a small
piece of paper "hidden" inside the cookie. This was the inspiration
behind <em>magic cookie</em>, which is a small piece of data or token
sent between programs over the network. In turn, the term "HTTP
cookie" was created from magic cookie by a programmer named Lou
Montulli.<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup></p></section>
<p>Let's explore an example of how the server sets the cookie and how the
client informs the servers with the cookie.</p>
<p>First, the server uses a <em>Set-Cookie</em> header as part of the HTTP
response.</p>
<pre id="fence-code-13" class="fence-code"><code>HTTP/2.0 200 OK
Content-Type: text/html
Set-Cookie: name=value
</code></pre>
<blockquote>
<p>Listing 9 - Set-Cookie header from server to client</p>
</blockquote>
<p>Then, the client can include the <em>Cookie</em> header in every request.</p>
<pre id="fence-code-14" class="fence-code"><code>Get /blog.php HTTP/2.0
Host: www.offsec.com
Cookie: name=value
</code></pre>
<blockquote>
<p>Listing 10 - Cookie header from client to server</p>
</blockquote>
<p>We are able to set multiple cookies too.</p>
<pre id="fence-code-15" class="fence-code"><code>HTTP/2.0 200 OK
Content-Type: text/html
Set-Cookie: name1=value1
Set-Cookie: name2=value2
</code></pre>
<blockquote>
<p>Listing 11 - Multiple Set-Cookie headers</p>
</blockquote>
<p>Then the client can include the Cookie header in every request to that
website.</p>
<pre id="fence-code-16" class="fence-code"><code>Get /blog.php HTTP/2.0
Host: www.offsec.com
Cookie: name1=value1; name2=value2
</code></pre>
<blockquote>
<p>Listing 12 - Multiple Cookie headers</p>
</blockquote>
<p>As previously mentioned, web cookies are used for things like session
management and tracking. While they can also authenticate users, that
is not typically a very secure approach because it presents a serious
security challenge and must be implemented carefully. For example,
cookie data should be encrypted and tamper-proof to avoid attackers
from viewing and/or manipulating it to send a different value. In
short, cookies are best used for tracking, not authentication.</p>
<p>Another popular attack example is using <em>cross-site scripting</em>
(XSS)<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> attacks to steal user cookies and impersonate the
user. There are many other types of attacks that stem from <em>cookie
based authentication</em>.<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup></p>
<p>Because cookies can allow web servers to track user activity,
growing privacy concerns have led to international cookie laws and
regulations.<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup></p>
<p>Because of the regulations regarding cookies, websites commonly inform
the users of the cookie usage. Additionally, the web server may also
allow the user to select which cookies to enable.</p>
<p>Now that we have an overview of cookies, let's examine some cookie
attributes.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/HTTP_cookie" target="_blank">https://en.wikipedia.org/wiki/HTTP_cookie</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Magic_cookie" target="_blank">https://en.wikipedia.org/wiki/Magic_cookie</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cross-site_scripting" target="_blank">https://en.wikipedia.org/wiki/Cross-site_scripting</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(XMind Map, 2022), <a href="https://www.xmind.net/m/2FwJ7D/" target="_blank">https://www.xmind.net/m/2FwJ7D/</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn5"><sup>5</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/HTTP_cookie#Privacy_and_third-party_cookies" target="_blank">https://en.wikipedia.org/wiki/HTTP_cookie#Privacy_and_third-party_cookies</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>HTTP Cookies - Attributes</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>The Set-Cookie header has a few <em>attributes</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>
that can increase the security of the cookie. However, other factors,
such as web server configuration, browser version, and improper
implementation, can negatively impact the level of security.</p>
<p>Similar to web storage, a cookie's lifespan can be adjusted to be
based on the session or exist longer (potentially "forever").</p>
<p><em>Session cookies</em> usually terminate once the session ends. This
may mean when the tab or browser closes. <em>Permanent cookies</em> will
last either until reaching a designated date/time value or after a
specific time period. We can achieve this by using something like the
<em>Expires</em> or <em>Max-Age</em> attributes.</p>
<pre id="fence-code-17" class="fence-code"><code>Set-Cookie: name1=value1; <span class="code-block-p">Expires=Mon, 01 Jan 2023 00:00:00 GMT</span>;
Set-Cookie: name2=value2; <span class="code-block-p">Max-Age=600</span>;
Set-Cookie: name3=value3; <span class="code-block-p">Expires=Mon, 01 Jan 2022 00:00:00 GMT</span>; <span class="code-block-p">Max-Age=800</span>;
</code></pre>
<blockquote>
<p>Listing 13 - Set-Cookie header with the Expires and Max-Age attributes</p>
</blockquote>
<p>The first cookie expires when the client machine reaches the specified
date/time value. The second cookie expires 600 seconds from the
time the session begins. The third cookie will actually ignore the
<em>Expires</em> attribute and follow the <em>Max-Age</em> attribute. Because the
<em>Expires</em> attribute has a date/time value in the past, it will exist
for 800 seconds based on the <em>Max-Age</em> attribute.</p>
<p>We can also declare which URLs the cookie is used with. In other
words, we can inform the browser of the cookie source. With the
<em>Domain</em> and <em>Path</em> attributes, we are able to specify either the URL
(domain) or the URI context (path). Subdomains are included <em>only</em> if
the domain is specified. For the <em>Path</em> attribute, subdirectories are
included by default.</p>
<pre id="fence-code-18" class="fence-code"><code>Set-Cookie: name1=value1; <span class="code-block-p">Domain=domain.com</span>;
Set-Cookie: name2=value2; <span class="code-block-p">Path=/accounts</span>;
Set-Cookie: name3=value3; <span class="code-block-p">Domain=domain.com</span>; <span class="code-block-p">Path=/accounts</span>;
</code></pre>
<blockquote>
<p>Listing 14 - Set-Cookie header with the Domain and Path attributes</p>
</blockquote>
<p>For the first example, cookies will be accepted with requests
of <strong>domain.com</strong> to include subdomains. The second example will
<em>only</em> accept cookies with requests of the host (web server), not
counting subdomains, and the path of <strong>domain.com/accounts</strong>. The
third example allows <strong>domain.com</strong>, any subdomain, and the path of
<strong>domain.com/accounts</strong>.</p>
<p>Some attributes will only accept certain values. For example, there
is an attribute named <em>SameSite</em> and it accepts <em>Strict</em>, <em>Lax</em>, or
<em>None</em> as the value. We can use this attribute to restrict cross-site
subrequests.</p>
<p>For example, with the <em>Lax</em> value, cross-site subrequests will be
accepted <em>only</em> when a user navigates to the origin site. This value
is the default for this attribute to create some protection against
<em>Cross-Site Request Forgery</em> (CSRF)<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> attacks. For security
reasons, we <em>must</em> also select the <em>Secure</em> attribute to set the value
to <em>None</em>.</p>
<pre id="fence-code-19" class="fence-code"><code>Set-Cookie: name1=value1; <span class="code-block-p">SameSite=None</span>; <span class="code-block-p">Secure</span>;
Set-Cookie: name2=value2; <span class="code-block-p">SameSite=Strict</span>;
</code></pre>
<blockquote>
<p>Listing 15 - Set-Cookie header with the SameSite attribute</p>
</blockquote>
<p>The first examples allows any cross-site subrequests to include
third-parties. There's also a <em>Secure</em> attribute, which we will
explain momentarily. The second example allows <em>only</em> first-party
subrequests. In other words, the cookies are from a different domain
than the one the user is currently browsing.</p>
<p>Some attributes don't need values, like <em>Secure</em> and <em>HttpOnly</em>. These
attributes are only included if we want to enable the feature.</p>
<p>With the <em>Secure</em> attribute set, cookies will only be accepted from
requests over HTTPS. This can help mitigate <em>monster-in-the-middle</em>
(MITM)<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> attacks.</p>
<p>Another way to mitigate some XSS attacks is to use the <em>HttpOnly</em>
attribute. This restricts the use of JavaScript from accessing the
cookie. The popular <em>document.cookie</em> property will not work if this
attribute is set.</p>
<p>Let's review an example with these attributes.</p>
<pre id="fence-code-20" class="fence-code"><code>Set-Cookie: name1=value1; <span class="code-block-p">Secure</span>; <span class="code-block-p">HttpOnly</span>;
</code></pre>
<blockquote>
<p>Listing 16 - Set-Cookie header with the Secure and HttpOnly attribute</p>
</blockquote>
<p>The cookie above has both attributes enabled, meaning cookies will
only be accepted over HTTPS and JavaScript cannot be used to access
the cookie. If an attacker were to attempt to access this cookie, the
browser would return an empty string. Both of these attributes can
help improve the overall security of implementing cookies for things
such as session management. The last Learning Unit will cover more
authentication methods used during session management such as single
sign-on.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Mozilla MDN Web docs, 2022), <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" target="_blank">https://en.wikipedia.org/wiki/Cross-site_request_forgery</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank">https://en.wikipedia.org/wiki/Man-in-the-middle_attack</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<!----><div><h2>Single Sign-On (SSO)</h2>
<p>This Learning Unit covers the following Learning Objectives:</p>
<ol>
<li>Learn how single sign-on (SSO) works</li>
<li>Describe various single sign-on protocols</li>
</ol>
<p>An important part of information technology (IT) is managing
identities. <em>Identity and Access Management</em> (IAM)<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>
is a massive discipline within IT that governs processes like
authentication and authorization. Technologies like <em>identity
management systems</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> are used to provide
authentication and/or authorization for employees within companies.
Due to the number of identity management systems and the challenges
they pose, centralized identity management is often desired.
<em>Federated identity</em><sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> provides a way for a user's identity
to access multiple identity management systems. Single sign-on is a
subdomain of federated identity.</p>
<p>In this Learning Unit, we will discuss single sign-on processes and
specifications, like OAuth and OpenID. The benefits of single sign-on
are most noticeable when the organization uses numerous types of
application resources. Without single sign-on or identity management,
the user has to create one username/password for each application. In
cases where there are 10 or 20 applications, it can be very cumbersome
for the user to sign in to all of the applications separately. Single
sign-on helps alleviate that problem and more.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Identity_management" target="_blank">https://en.wikipedia.org/wiki/Identity_management</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Identity_management#Management_systems" target="_blank">https://en.wikipedia.org/wiki/Identity_management#Management_systems</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Federated_identity" target="_blank">https://en.wikipedia.org/wiki/Federated_identity</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!---->

<h2>Single Sign-On Process</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p><em>Single sign-on</em> (SSO)<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup> is a process where a user
authenticates once and is able to access multiple resources that would
normally require their own authentication. This is different from
centralized identity management, which is where the same identity such
as username and password, are synchronized between different systems.
SSO is a layer that negotiates authentication and authorization on
behalf of the user to reduce the number of authentications required
for a user and a group of resources.</p>
<p>A physical world example of this is someone attending a conference
located at a hotel. Upon entry, the person provides proof of their
identity, which is validated. Then, they are given a badge to wear
throughout their stay. The badge is used as "proof" that they were
vetted so they don't have to validate their identity from room to
room. Single sign-on is very similar in that regard with computer
resources.</p>
<p>Centralized identity providers can be used to improve user experience
by reducing the number of passwords the user needs to maintain at the
cost of that single password having greater impact if compromised. SSO
systems might also aid identity management systems in tracking user
activity more consistently. But there is greater risk if the single
authentication or authorization are too easily given out or if it uses
weak passwords for identity.</p>
<p>SSO can improve security by reducing the amount of times real
passwords need to be entered in different systems or passed around.
By leveraging short-lived tokens and negotiated access, the attack
surface has the potential to shrink. While there is that potential,
managing and implementing access tokens moves the problem from
passwords to these tokens, and sometimes significant engineering must
be done to secure said tokens.</p>
<p>From a user perspective, less time spent entering credentials is
commonly more enjoyable. Employee on-boarding and off-boarding can
also be more efficient in some cases. Technicians can add a user and
enable the resources they should have access to more effectively when
they can control it from the SSO system. When the employee leaves,
the technician can disable access if there is a centralized system.
We can still have a centralized identity system without SSO, as we
can have granular access controls and manage them centrally. The
operations costs are typically greater for each additional source of
truth that must be maintained. Collapsing the many different software
and hardware resources into a few well-managed and engineered identity
systems is ideal.</p>
<p>One of the biggest downsides is a single point of failure. Issues like
incorrect configuration, software vulnerability, and poor password
management are all potential costs to an individual or organization.
If an unauthorized person is able to gain access as an existing user
identity, they might gain access to all the resources available to
that user.</p>
<p>There are several ways to reduce risks of SSO. As with all systems,
multi-factor authentication, continuous security assessment, and
keeping systems updated with patches can help an organization improve
security of SSO and identity systems. We'll explore more about
defending SSO and identity management in a separate module.</p>
<p>Alongside the single point of failure is equipment failure. Power or
network issues can stop company wide operations if users can't access
resources to do their jobs. <em>Uninterruptible power supply</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup>
and <em>network redundancy</em><sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> are some ways to
address equipment failure. We will cover failure scenarios further in
another module.</p>
<p>There may be challenges with integrating applications into the
single sign-on framework. Depending on the situation though, the time
investment and resources may be worthwhile long-term to build up SSO
with MFA layers for our internal and external user accounts. Nothing
is unhackable, however. MFA can be bypassed. But a layered approach
is important for defense in depth. As we design systems architectures,
we can consider these technologies for sessions as different layers
working together to provide multiple protections against adversaries.</p>
<p>Rarely is every asset behind a single SSO service, and that is
not inherently a problem. There are advantages to SSO, but those
advantages must be balanced carefully with the overall systems
architecture and user needs.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Single_sign-on" target="_blank">https://en.wikipedia.org/wiki/Single_sign-on</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Uninterruptible_power_supply" target="_blank">https://en.wikipedia.org/wiki/Uninterruptible_power_supply</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Techopedia, 2022), <a href="https://www.techopedia.com/definition/29305/network-redundancy" target="_blank">https://www.techopedia.com/definition/29305/network-redundancy</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>

<h2>Single Sign-On Protocols</h2>

<div class="markdown-content text-main-color flex-grow my-6 mx-auto"><!----><div><p>In this section, we will introduce four single sign-on technologies:
Open Authorization (OAuth), OpenID, OpenID Connect (OIDC), and
Security Assertion Markup Language (SAML).</p>
<p><em>Open Authorization</em> (OAuth)<sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>, <em>OpenID</em><sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup>,
<em>OpenID Connect</em> (OIDC), and <em>Security Assertion Markup Language</em>
(SAML)<sup class="footnote-ref"><a href="#fn3" id="fnref3">3</a></sup> are all specifications we can leverage for enabling
authentication and authorization.</p>
<p>The OAuth process overview can be summarized in this example flow.</p>
<pre id="fence-code-21" class="fence-code"><code>     +----------+
     | Resource |
     |  Owner   |
     |          |
     +----------+
          ^
          |
         (B)
     +----|-----+          Client Identifier     +---------------+
     |         -+----(A)-- &amp; Redirection URI ---&gt;|               |
     |  User-   |                                | Authorization |
     |  Agent  -|----(B)-- User authenticates --&gt;|     Server    |
     |          |                                |               |
     |          |&lt;---(C)--- Redirection URI ----&lt;|               |
     |          |          with Access Token     +---------------+
     |          |            in Fragment
     |          |                                +---------------+
     |          |----(D)--- Redirection URI ----&gt;|   Web-Hosted  |
     |          |          without Fragment      |     Client    |
     |          |                                |    Resource   |
     |     (F)  |&lt;---(E)------- Script ---------&lt;|               |
     |          |                                +---------------+
     +-|--------+
       |    |
      (A)  (G) Access Token
       |    |
       ^    v
     +---------+
     |         |
     |  Client |
     |         |
     +---------+
</code></pre>
<blockquote>
<p>Listing 17 - Example OAuth flow</p>
</blockquote>
<p>The example OAuth flow comes from the OAuth specification,
demonstrating how authentication and authorization work with OAuth.
The authentication takes place and then the authorization facilitates
providing a token to access the requested resource.</p>
<p>While both OAuth and SAML have some similarities, they have distinctly
different data structures and specification details. OAuth may be
considered more flexible in terms of specification, with detail around
authorization yet leaving authentication more open-ended. SAML has a
more verbose data structure, is designed for an enterprise use-case,
and can integrate with OAuth to extend capabilities. SAML uses XML
while OAuth uses JSON. When SAML incorporates OAuth, SAML assertions
act as the OAuth client and SAML can act as an authentication
mechanism for OAuth.</p>
<p>The SAML process has three main parties: a user (the client),
an <em>identity provider</em> (IdP),<sup class="footnote-ref"><a href="#fn4" id="fnref4">4</a></sup> and a <em>service provider</em>
(SP).<sup class="footnote-ref"><a href="#fn5" id="fnref5">5</a></sup></p>
<ul>
<li>First, the user requests access to a SP.</li>
<li>The SP sends an authentication request to the IdP.</li>
<li>The IdP confirms the authentication request, and then the user can
authenticate with the IdP.</li>
<li>Once the IdP has validated the user's identity, the IdP will craft
a SAML assertion and send it to the SP. The assertion is a group of
<em>Extensible Markup Language</em> (XML)<sup class="footnote-ref"><a href="#fn6" id="fnref6">6</a></sup> statements that detail
the permissions the user has. The SP uses these statements to decide
what resources the user can have access to.</li>
<li>The SP uses the assertion to provide proper access (or
authorization) based on the data within the assertion.</li>
</ul>
<p>Below is an example SAML 2.0 assertion<sup class="footnote-ref"><a href="#fn7" id="fnref7">7</a></sup>, with
the whitespace only for display purposes. Normally, the XML would
not have whitespaces and appear as an XML blob. We don't need to
understand everything about this example for this module, but we can
start to familiarize ourselves with the terms and structures we might
encounter in SAML 2.0. Note that some was cut from the signature block
in the example. We would normally find more information about the
cryptographic algorithms and details in that section.</p>
<pre id="fence-code-22" class="fence-code"><code>     &lt;Assertion IssueInstant="2010-10-01T20:07:34.619Z"
       ID="ef1xsbZxPV2oqjd7HTLRLIBlBb7"
       Version="2.0"
       xmlns="urn:oasis:names:tc:SAML:2.0:assertion"&gt;
      &lt;Issuer&gt;https://saml-idp.example.com&lt;/Issuer&gt;
      &lt;ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
       ....(CUT)....
       &lt;ds:SignatureValue&gt;FOeNYNCfzxWMDlnWPzbBagVt1qqrSvDmtmcBhxYQnpKS2Y/OR90dTSMPY5mV+TNnIV9ELxD2ht8ialJ+4fjLqboKBm0rCfuExu9VByZ3LtnjtcFJpjTuARsS7iUdiywlRCoWUAO/GiYBHSc111KEOURiRx6tDlIPksJNNTwL5wo=&lt;/ds:SignatureValue&gt;
       ...(CUT)...
      &lt;/ds:Signature&gt;
      &lt;Subject&gt;
       &lt;NameID
        Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress"&gt;
        bob@example.com
       &lt;/NameID&gt;
       &lt;SubjectConfirmation
         Method="urn:oasis:names:tc:SAML:2.0:cm:bearer"&gt;
        &lt;SubjectConfirmationData
          NotOnOrAfter="2021-10-01T20:12:34.619Z"
          Recipient="https://authz.example.net/token.oauth2"/&gt;
        &lt;/SubjectConfirmation&gt;
       &lt;/Subject&gt;
       &lt;Conditions&gt;
         &lt;AudienceRestriction&gt;
           &lt;Audience&gt;https://saml-sp.example.net&lt;/Audience&gt;
         &lt;/AudienceRestriction&gt;
       &lt;/Conditions&gt;
       &lt;AuthnStatement AuthnInstant="2021-10-01T20:07:34.371Z"&gt;
         &lt;AuthnContext&gt;
           &lt;AuthnContextClassRef&gt;
             urn:oasis:names:tc:SAML:2.0:ac:classes:X509
           &lt;/AuthnContextClassRef&gt;
         &lt;/AuthnContext&gt;
       &lt;/AuthnStatement&gt;
     &lt;/Assertion&gt;
</code></pre>
<blockquote>
<p>Listing 18 - Example SAML 2.0 XML</p>
</blockquote>
<p>The example SAML 2.0 assertion XML is detailed; we can find email
address, digital signature, service provider URL, and IdP URL within
the assertion. SAML provides a large feature set with detailed XML
data that can help an organization integrate many different systems.
While the many SAML properties can be useful, they can also be
time-consuming for programmers to manage in some situations.</p>
<p>OAuth can provide some relief from the complexity of SAML and
is easier to program. One common approach is combining OpenID
(authentication protocol) with OAuth 2.0 into a technology called
OpenID Connect (OIDC). This enables us to sign in to applications
using third-party accounts. We can use OIDC to let Google
authentication approve authorization for our service. OIDC takes
OAuth and adds additional authentication and client identification
capabilities on top of the OAuth specification.</p>
<p>If the organization desires the ability to authenticate using
third-party accounts and provide delegated access control, OIDC might
be a good choice. With OIDC, we have the potential to save costs by
offloading some of the computation and configuration to an external
authoritative identity provider, such as a social media platform.</p>
<p>OIDC can also be used internally like SAML, meaning that we can host
our own OIDC authority instead of outsourcing it to a third party.
Using an internal OIDC system is more common within an organization's
private access. The organization might have a control panel interface
for the administrators integrated with OIDC, allowing those authorized
for the control panel to be authorized for other infrastructure
systems.</p>
<p>We will review an example JSON lease for an OIDC integration. Notice
how the example OIDC lease doesn't expose as much PII information as a
SAML 2.0 assertion. This isn't always the case - some implementations
of OIDC may also include more data. The example OIDC lease also
doesn't contain a digital signature like the SAML 2.0 example, but
instead, has some more compact strings including a token.</p>
<p>The token is provided after successful authentication and represents
the authorization. The token itself can be used by the client
or client software to access the service provider resource for a
configured period of time before the token expires.</p>
<pre id="fence-code-23" class="fence-code"><code>{
  "request_id": "c624533b-c6ad-732d-c4s1-17aa18b88cd6",
  "lease_id": "",
  "renewable": false,
  "lease_duration": 0,
  "data": null,
  "wrap_info": null,
  "warnings": null,
  "auth": {
    "client_token": "s.TWRJ1dMCIo1g3BM70rj3V2kc",
    "accessor": "zoY1rht813rTlWZwaagDXnBe",
    "policies": [
      "default"
    ],
    "token_policies": [
      "default"
    ],
    "metadata": {
      "role": "group-2"
    },
    "lease_duration": 2764800,
    "renewable": true,
    "entity_id": "82b10fef-c214-5eba-2323-51647fe35a23",
    "token_type": "service",
    "orphan": true
  }
}
</code></pre>
<blockquote>
<p>Listing 19 - Example OIDC JSON token lease</p>
</blockquote>
<p>The token lease JSON example would then be parsed and the token used
to access the resource. If a file like this were to be discovered
by an adversary, the token could potentially be collected and used.
Although, in many OIDC systems, the token is short-lived so the
adversary likely would need to act fast to utilize it. If the OIDC
configuration allows long-lived tokens, the adversary has more time to
attempt to use the acquired token.</p>
<p>Companies can deploy any (or a combination) of the above single
sign-on solutions, or others. OAuth, OpenID, and SAML can also
be implemented along with <em>Active Directory</em> (AD),<sup class="footnote-ref"><a href="#fn8" id="fnref8">8</a></sup>
<em>LDAP</em>,<sup class="footnote-ref"><a href="#fn9" id="fnref9">9</a></sup> or other identity and access systems. Factors like
purpose, software compatibility, and business needs may influence
which solution or solutions are better to implement for a given
architecture.</p>
<p>There are more technologies to implement SSO, and we don't have to
pick just one. SSO solutions will frequently use multiple protocols
together. It is rare that we truly have a single sign-on. Most
commonly, SSO is only a specific scope of assets for an individual
and within an organization. It is normal and not always a bad thing
to have multiple scopes of authority. We typically have one scope of
identity for workstations and servers in an organization and another
for external users and public application assets.</p>
<section class="footnote-container"><div class="footnote-item" id="fn1"><sup>1</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/OAuth" target="_blank">https://en.wikipedia.org/wiki/OAuth</a> <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn2"><sup>2</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/OpenID" target="_blank">https://en.wikipedia.org/wiki/OpenID</a> <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn3"><sup>3</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language" target="_blank">https://en.wikipedia.org/wiki/Security_Assertion_Markup_Language</a> <a href="#fnref3" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn4"><sup>4</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Identity_provider_(SAML)" target="_blank">https://en.wikipedia.org/wiki/Identity_provider_(SAML)</a> <a href="#fnref4" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn5"><sup>5</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Service_provider_(SAML)" target="_blank">https://en.wikipedia.org/wiki/Service_provider_(SAML)</a> <a href="#fnref5" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn6"><sup>6</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/XML" target="_blank">https://en.wikipedia.org/wiki/XML</a> <a href="#fnref6" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn7"><sup>7</sup><p>(ietf, 2015) <a href="https://datatracker.ietf.org/doc/html/rfc7522" target="_blank">https://datatracker.ietf.org/doc/html/rfc7522</a> &gt; <a href="#fnref7" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn8"><sup>8</sup><p>(Wikipedia, 2022), <a href="https://en.wikipedia.org/wiki/Active_Directory" target="_blank">https://en.wikipedia.org/wiki/Active_Directory</a> <a href="#fnref8" class="footnote-backref">↩︎</a></p>
</div><div class="footnote-item" id="fn9"><sup>9</sup><p>(ietf, 2006) <a href="https://datatracker.ietf.org/doc/html/rfc4511" target="_blank">https://datatracker.ietf.org/doc/html/rfc4511</a> <a href="#fnref9" class="footnote-backref">↩︎</a></p>
</div></section></div><!----></div>